<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tremor Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tremor Blog Atom Feed"><title data-react-helmet="true">Google Cloud Storage and Pub/Sub Connectors | Tremor</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://www.tremor.rs//blog/2021/06/29/T17-LFX-Blog-Jigyasa-gcloud"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Google Cloud Storage and Pub/Sub Connectors | Tremor"><meta data-react-helmet="true" name="description" content="Jigyasa&#x27;s LFX spring Mentorship experience report."><meta data-react-helmet="true" property="og:description" content="Jigyasa&#x27;s LFX spring Mentorship experience report."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-06-29T00:00:00.000Z"><meta data-react-helmet="true" property="article:tag" content="connectors,mentorship,cncf,gpc"><link data-react-helmet="true" rel="shortcut icon" href="/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.tremor.rs//blog/2021/06/29/T17-LFX-Blog-Jigyasa-gcloud"><link data-react-helmet="true" rel="alternate" href="https://www.tremor.rs//blog/2021/06/29/T17-LFX-Blog-Jigyasa-gcloud" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.tremor.rs//blog/2021/06/29/T17-LFX-Blog-Jigyasa-gcloud" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.b987a0a0.css">
<link rel="preload" href="/assets/js/runtime~main.c155440f.js" as="script">
<link rel="preload" href="/assets/js/main.ea8dcffb.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.tremor.rs/" target="_self" rel="noopener noreferrer" class="navbar__brand"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/next/getting-started/getting-started">Getting Started</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/community/community">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/community">Overview</a></li><li><a href="https://chat.tremor.rs" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Chat<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a class="dropdown__link" href="/community/governance">Governance</a></li><li><a class="dropdown__link" href="/community/faqs">FAQs</a></li><li><a class="dropdown__link" href="/rfc/index">RFCs</a></li><li><a class="dropdown__link" href="/community/EventsAndMedia">Events and Media</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/index">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/docs/index">0.11</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/getting-started/getting-started">Next</a></li><li><a class="dropdown__link" href="/docs/index">0.11</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://chat.tremor.rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discord-link" aria-label="Community Chat"></a><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/06/Blog-Rohit-Property-Based-Testing">Property Based Testing of Tremor Script</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/LFX-Blog-Nupur">Support for the Syslog Protocol</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2021/06/29/T17-LFX-Blog-Jigyasa-gcloud">Google Cloud Storage and Pub/Sub Connectors</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/02/12/v010-release">Releasing Tremor v0.10!</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/10/16/v09-release">Releasing Tremor v0.9!</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">Google Cloud Storage and Pub/Sub Connectors</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-06-29T00:00:00.000Z" itemprop="datePublished">June 29, 2021</time> Â· 13 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Jigyasa Khaneja</span></a></div><small class="avatar__subtitle" itemprop="description">Tremor 2021 Spring Mentee</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h3><p>Hello folks! I&#x27;m Jigyasa, a final-year computer science engineering student at Indira Gandhi Delhi Technical University for Women pursuing my bachelor&#x27;s in Technology. This blog is about my experience contributing to <a href="https://www.tremor.rs/" target="_blank" rel="noopener noreferrer">Tremor</a> as part of the LFX Mentorship program.
i</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="learning-about-tremor"></a>Learning about Tremor<a class="hash-link" href="#learning-about-tremor" title="Direct link to heading">#</a></h3><p>Tremor is an event processing system for unstructured data with rich support for structural pattern matching, filtering, and transformation. It is built for users that have a high message volume to deal with and want to build pipelines to process, route, or limit this event stream. It has a scripting language called tremor-script and a query language as well called tremor-query or trickle.</p><p>I had never worked on an event processing system before this internship. In fact, my first major contribution to open-source was through this mentorship program. To get started with it, my mentor <a href="https://www.linkedin.com/in/darach-ennis-789866?lipi=urn%3Ali%3Apage%3Ad_flagship3_search_srp_all%3BnRZIYeLfRAWJpWsDNlzweA%3D%3D" target="_blank" rel="noopener noreferrer">Darach Ennis</a>, suggested me some documents that helped me learn more about it:</p><p><a href="/docs/overview/">/docs/overview/</a></p><p><a href="/docs/course/#/2">/docs/course</a></p><p>Apart from that, learning more about the tremor-query, tremor-script, and going through the workshops in the docs can be really helpful.</p><p>The codebase of Tremor is in Rust, and since I had no prior experience with Rust, I started learning the language.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="learning-rust"></a>Learning Rust<a class="hash-link" href="#learning-rust" title="Direct link to heading">#</a></h3><p>Getting started with Rust was very intimidating. It involved working with things like memory management, borrow checker, lifetimes, and the expressive types which was very new to me and hence, confusing</p><p>While getting started with a new language, I try to follow along some interactive tutorials/videos. These are some resources that I found helpful: </p><p><a href="https://serokell.io/blog/learn-rust" target="_blank" rel="noopener noreferrer">https://serokell.io/blog/learn-rust</a></p><p><a href="https://fasterthanli.me/articles/a-half-hour-to-learn-rust" target="_blank" rel="noopener noreferrer">https://fasterthanli.me/articles/a-half-hour-to-learn-rust</a></p><p><a href="https://doc.rust-lang.org/book/" target="_blank" rel="noopener noreferrer">https://doc.rust-lang.org/book/</a></p><p>However, while coding I used to run into a lot of errors. My mentor suggested me a good practice which is to document those errors and always make good notes of anything and everything I learn. So the next time I come across something similar, I can refer to my notes instead of searching that up on the internet. I used to document the little things like a new <code>vi</code> or <code>git</code> command that I learned and found helpful. It&#x27;s also very important to keep those notes organized so that it&#x27;s faster and easier to find what you&#x27;re looking for. Compiling notes of all the new things learned in a day can be very helpful.</p><p>At times when I used to get stuck with some Rust errors, I used to reach out to my mentor or anyone from the Tremor community and they would help me. Apart from that, these discord servers can be of great help too:</p><p><a href="https://discord.gg/rust-lang-community" target="_blank" rel="noopener noreferrer">Rust programming language community server</a></p><p><a href="https://discord.gg/4BUXJEB2" target="_blank" rel="noopener noreferrer">Firepit</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="my-project"></a>My Project<a class="hash-link" href="#my-project" title="Direct link to heading">#</a></h3><p>My task during the internship was to add support for the Google Cloud connectors in Tremor. I worked on adding the Google Cloud Storage and Google Cloud Pub/Sub connectors. A detailed description of it can be found here:</p><p><a href="https://github.com/tremor-rs/tremor-runtime/issues/724" target="_blank" rel="noopener noreferrer">https://github.com/tremor-rs/tremor-runtime/issues/724</a></p><p>Before explaining more about it, here&#x27;s what a connector involves:</p><p><strong>Sources:</strong> Ingest data from the outside world and deserialise to events ( onramps )</p><p><strong>Sinks:</strong> Send serialised events to the outside world ( offramps )</p><p>Connectors serve the purpose of sending events to and receiving events from the outside world. A connector can be an event <code>source</code> (a.k.a. <code>onramp</code>) or an event <code>sink</code> (a.k.a. <code>offramp</code>) or both.</p><p><img alt="Connector" src="/assets/images/connector-b5049c7dbfe33de71b96d2ee25136f23.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="google-cloud-storage-connector"></a>Google Cloud Storage connector:<a class="hash-link" href="#google-cloud-storage-connector" title="Direct link to heading">#</a></h4><p>I wrote a GCS sink that can issue the basic GCS Operations such as list buckets and objects, create, insert and delete objects from the Google Cloud Platform cloud storage service. The docs can be found here: <a href="/docs/artefacts/offramps/#gcs">GCS offramp docs</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="google-cloud-pubsub-connector"></a>Google Cloud Pub/Sub connector:<a class="hash-link" href="#google-cloud-pubsub-connector" title="Direct link to heading">#</a></h4><p>The gpub sink can issue the operation of sending a message to a Google Cloud Pub/Sub topic. It also allows creating a subscription to a topic to receive messages in it, with the option to enable/disable message ordering. The gsub source allows receiving messages via a subscription in batches as well as one after another. The docs can be found here:
<a href="/docs/artefacts/offramps/#gpub">gpub offramp</a> and <a href="/docs/artefacts/onramps/#gsub">gsub onramp</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="walk-through-guide"></a>Walk-Through Guide<a class="hash-link" href="#walk-through-guide" title="Direct link to heading">#</a></h2><p>To get started, you need a service account on GCP and you will need a GCP pem file for certificates authentication and a service token json file.</p><p>The command used to get the service token <code>json</code> file:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud iam service-accounts keys create key-file.json -iam-account</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">iam-account-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">@</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">project-id</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">.iam.gserviceaccount.com</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>or </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud iam service-accounts keys create key-file.json -iam-account</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">mail-id-of-service-account</span><span class="token operator" style="color:#393A34">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Go to GCP dashboard â†’ IAM &amp; Admin â†’ Service Accounts and get the email-id mentioned which is the <code>&lt;mail-id-of-service-account&gt;</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="google-cloud-storage"></a>Google Cloud Storage<a class="hash-link" href="#google-cloud-storage" title="Direct link to heading">#</a></h3><p>The following is a usage example of the gcs connector. The following files are required:</p><p><strong>outbound.trickle</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly trickle"><pre tabindex="0" class="prism-code language-trickle codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">select event from in into out</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>inbound.trickle</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly trickle"><pre tabindex="0" class="prism-code language-trickle codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">select event from in into out</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>test.yaml</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">offramp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stdout</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stdout</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">codec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcs</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcs</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">codec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">postprocessors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> gzip   </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">preprocessors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> gzip </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">linked</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">pem</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;path</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pem</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">file</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">onramp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stdin</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> file</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">codec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /dev/stdin   </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">binding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> example</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">links</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&#x27;/onramp/stdin/{instance}/out&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/pipeline/outbound/{instance}/in&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&#x27;/pipeline/outbound/{instance}/out&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/offramp/stdout/{instance}/in&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/offramp/gcs/{instance}/in&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&#x27;/offramp/gcs/{instance}/out&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/pipeline/inbound/{instance}/in&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&#x27;/pipeline/inbound/{instance}/out&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/offramp/stdout/{instance}/in&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mapping</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">&quot;/binding/example/passthrough&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;passthrough&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The above config receives <code>json</code> on stdin, sends it to Google Cloud Storage service (and stdout) and writes the response received from GCS (since <code>linked: true</code>) to stdout.</p><p>The instance variable (in the binding) is replaced by the value passthrough in the mapping upon deployment, so it is possible to define multiple bindings (deployments) for a single mapping (template).
Supported preprocessors, that can be configured in yaml file can be found here: <a href="/docs/artefacts/preprocessors/">preprocessors</a>. Supported postprocessors and more about it: <a href="/docs/artefacts/postprocessors/">postprocessors</a>.
Supported codecs, that can be configured in yaml file can be found here: <a href="/docs/artefacts/codecs/">codecs</a></p><ul><li>Set the env variable</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">GOOGLE_APPLICATION_CREDENTIALS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;path-to-service-token-json-file&gt;&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Command used to run tremor:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tremor server run -f outbound.trickle inbound.trickle test.yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> jq </span><span class="token builtin class-name">.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For a detailed guide on the Operations that can be performed, refer the <a href="/docs/artefacts/offramps/#gcs">docs</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="google-cloud-pubsub"></a>Google Cloud Pub/sub<a class="hash-link" href="#google-cloud-pubsub" title="Direct link to heading">#</a></h3><p>Google Cloud Pub/Sub guarantees delivery of all messages, whether low throughput or high throughput, so there should be no concern about messages being lost.</p><p>Pub/Sub guarantees at-least-once message delivery, which means that occasional duplicates are to be expected since we acknowledge the messages once they are received.</p><p>The following is a usage example of the pub/sub connector. These are the files required:</p><p><strong>outbound trickle:</strong> </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly trickle"><pre tabindex="0" class="prism-code language-trickle codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">select event from in into out</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>inbound.trickle:</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly trickle"><pre tabindex="0" class="prism-code language-trickle codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">select {&quot;data&quot;: event, &quot;meta&quot;: $} from in into out;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>test.yaml:</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">offramp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stdout</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stdout</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">codec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gpub</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gpub</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">codec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">postprocessors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> gzip    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">linked</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">pem</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;path</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pem</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">file</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">onramp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stdin</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> file</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">codec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /dev/stdin  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gsub</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gsub</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">codec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> json  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">preprocessors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> gzip</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">pem</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;path</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pem</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">file</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">subscription</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;name-of-subscription&gt;&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">binding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> example</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">links</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&#x27;/onramp/stdin/{instance}/out&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/pipeline/outbound/{instance}/in&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&#x27;/pipeline/outbound/{instance}/out&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/offramp/stdout/{instance}/in&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/offramp/gpub/{instance}/in&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&#x27;/offramp/gpub/{instance}/out&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/pipeline/inbound/{instance}/in&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&#x27;/pipeline/inbound/{instance}/out&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/offramp/stdout/{instance}/in&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&#x27;/onramp/gsub/{instance}/out&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/pipeline/inbound/{instance}/in&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mapping</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">&quot;/binding/example/passthrough&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;passthrough&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The above config receives <code>json</code> on stdin, sends it to Google Pub/sub service (and stdout) and writes the response received from Google Pub/sub (since <code>linked</code> is set to true) to stdout. At the same time, it also receives the messages for the configured subscription from Google pub/sub and writes those messages to stdout.</p><p>Supported preprocessors, that can be configured in yaml file can be found here: <a href="/docs/artefacts/preprocessors/">preprocessors</a>.
Supported postprocessors and more about it: <a href="/docs/artefacts/postprocessors/">postprocessors</a>.
Supported codecs, that can be configured in yaml file can be found here: <a href="/docs/artefacts/codecs/">codecs</a></p><p><img alt="Tremor Dot Diagram" src="/assets/images/dot-diagram-38e419be865fb5bf57190638508a7b39.png"></p><ul><li>Create a topic using the following <code>gcloud</code> command:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud pubsub topics create </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">topic-name</span><span class="token operator" style="color:#393A34">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Set the env variable</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">GOOGLE_APPLICATION_CREDENTIALS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;path-to-service-token-json-file&gt;&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Command used to run tremor:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tremor server run -f outbound.trickle inbound.trickle test.yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> jq </span><span class="token builtin class-name">.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Refer to the <a href="/docs/artefacts/offramps/#gpub">gpub</a> and <a href="/docs/artefacts/onramps/#gsub">gsub</a> docs to perform opertaions.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="testing-for-gsub-onramp-pubsub"></a>Testing for gsub onramp (Pub/sub)<a class="hash-link" href="#testing-for-gsub-onramp-pubsub" title="Direct link to heading">#</a></h2><p>Google Cloud Pub/Sub guarantees delivery of all messages and also preserves the order of messages if the subscription has <code>message-ordering</code> set.</p><p>However, we wish to test the property of guranteed delivery and message-ordering for gsub in events like poor network connectivity. In order to test, before sending the message to pub/sub, we add a field <code>count</code> in the event (json) that increments every time we send a message. This would be done in the outbound trickle file. To validate that all the messages are received in order, we have a validation logic in the inbound trickle file that checks if the difference between the <code>count</code> value of the current message and the previous message is one, the order is maintained.</p><p>For this purpose, we also use a write-ahead log or <code>wal</code> that builds on circuit breaker and acknowledgement mechanisms to provide guaranteed delivery. The write-ahead log is useful in situations where sources/onramps do not offer guaranteed delivery themselves, but the data being distributed downstream can benefit from protection against loss and duplication.</p><p>We have 3 different configurations for the outbound trickle file - using a <a href="/docs/workshop/examples/20_transient_gd/">transient wal</a>, <a href="/docs/workshop/examples/21_persistent_gd/">persistent wal</a> and no wal. The cofigurations are as follows:</p><p><strong>No wal</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly trickle"><pre tabindex="0" class="prism-code language-trickle codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">define script counter</span></span><span class="token-line" style="color:#393A34"><span class="token plain">script</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  let count = match state==null of</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    case true =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    default =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      state.count + 1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  end;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  let state = {&quot;count&quot;: count};</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  {&quot;command&quot;: &quot;send_message&quot;, &quot;project&quot;:&quot;&lt;project-id&gt;&quot;, &quot;topic&quot;:&quot;&lt;topic-name&gt;&quot;, &quot;data&quot;: merge event of {&quot;count&quot;: state.count} end, &quot;ordering_key&quot;: &quot;&lt;ordering-key&gt;&quot;}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">end;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">create script counter;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">select event from in into counter;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">select event from counter into out;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Transient-wal</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly trickle"><pre tabindex="0" class="prism-code language-trickle codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">define qos::wal operator in_memory_wal</span></span><span class="token-line" style="color:#393A34"><span class="token plain">with</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  read_count = 20,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  max_elements = 1000, # Capacity limit of 1000 stored events</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  max_bytes = 10485760 # Capacity limit of 1MB of events</span></span><span class="token-line" style="color:#393A34"><span class="token plain">end;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">create operator in_memory_wal;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">define script counter</span></span><span class="token-line" style="color:#393A34"><span class="token plain">script</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  let count = match state==null of</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    case true =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    default =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      state.count + 1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  end;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  let state = {&quot;count&quot;: count};</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  {&quot;command&quot;: &quot;send_message&quot;, &quot;project&quot;:&quot;&lt;project-id&gt;&quot;, &quot;topic&quot;:&quot;&lt;topic-name&gt;&quot;, &quot;data&quot;: merge event of {&quot;count&quot;: state.count} end, &quot;ordering_key&quot;: &quot;&lt;ordering-key&gt;&quot;}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">end;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">create script counter;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">select event from in into counter;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">select event from counter into in_memory_wal;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">select event from in_memory_wal into out;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Persistent-wal</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly trickle"><pre tabindex="0" class="prism-code language-trickle codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">define qos::wal operator on_disk_wal</span></span><span class="token-line" style="color:#393A34"><span class="token plain">with</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  read_count = 20,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  max_elements = 1000, # Capacity limit of 1000 stored events</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  max_bytes = 10485760 # Capacity limit of 1MB of events</span></span><span class="token-line" style="color:#393A34"><span class="token plain">end;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">create operator on_disk_wal;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">define script counter</span></span><span class="token-line" style="color:#393A34"><span class="token plain">script</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  let count = match state==null of</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    case true =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    default =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      state.count + 1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  end;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  let state = {&quot;count&quot;: count};</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  {&quot;command&quot;: &quot;send_message&quot;, &quot;project&quot;:&quot;&lt;project-id&gt;&quot;, &quot;topic&quot;:&quot;&lt;topic-name&gt;&quot;, &quot;data&quot;: merge event of {&quot;count&quot;: state.count} end, &quot;ordering_key&quot;: &quot;&lt;ordering-key&gt;&quot;}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">end;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">create script counter;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">select event from in into counter;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">select event from counter into on_disk_wal;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">select event from on_disk_wal into out;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the <strong>inbound</strong> trickle, we have the validation logic as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly trickle"><pre tabindex="0" class="prism-code language-trickle codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">define script validate</span></span><span class="token-line" style="color:#393A34"><span class="token plain">script</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  match state == null of</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    case true =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      let valid = match event.data.count == 0 of </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        case true =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          true      </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        default =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          false</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      end,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      let state = {&quot;prev&quot;: event.data.count},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      {&quot;response&quot;: event, &quot;valid&quot;: valid} </span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    default =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      let valid = match state.prev + 1 == event.data.count of </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        case true =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        default =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          false</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      end,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      let state = {&quot;prev&quot;: event.data.count},</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span></span><span class="token-line" style="color:#393A34"><span class="token plain">      {&quot;response&quot;:event, &quot;valid&quot;: valid}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  end;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">end;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">create script validate;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">select {&quot;data&quot;: event, &quot;meta&quot;: $} from in into validate;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">select event from validate into out;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For the testing, we run the sink (a.k.a offramp) to send messages and source (a.k.a onramp) to receive messages separately.</p><p><img alt="Testing gsub" src="/assets/images/validation-testing-image-35e388fced29a6888b362e9ab78e7da2.png"></p><hr><p><strong><em>Note:</em></strong>
<em>On stopping the server and resarting right afterwards, we see that we lost 1 message (id 7) which was acknwledged inside tremor but not yet fully delivered to the console by gsub.</em></p><hr><p>In all the 3 cases, we obtain similar results. We observe that on restarting tremor, we may lose in flight messages (events) that were already acknowledged at the time the server went down and thus not fully delivered by the downstream system. We may also observe duplicate messages (messages being received more than once). However, the order of messages is preserved.
Hence, for the <code>gsub</code> onramp, a <code>wal</code> can assist with partial recovery of downstream system but it is not guarenteed to be lossless.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="network-failure-recovery"></a>Network Failure Recovery<a class="hash-link" href="#network-failure-recovery" title="Direct link to heading">#</a></h2><p><img alt="Network Failure Recovery testing" src="/assets/images/network-failure-testing-7b192bf0cc0bad6271046fd9ae4cc2f5.png"></p><p>While testing in poor connectivity, the pivot point (where it works) was observed when downlink and uplink packets dropped varies between 47%-50%. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="use-of-connectors"></a>Use of Connectors<a class="hash-link" href="#use-of-connectors" title="Direct link to heading">#</a></h2><ul><li>Bulk batch rolling event/log storage to GCS</li><li>Distribution of openTelemetry logs/trace/metrics over GCP pub/sub</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="the-tremor-community"></a>The Tremor community<a class="hash-link" href="#the-tremor-community" title="Direct link to heading">#</a></h2><p>The Tremor community is absolutely great. As I was contributing to it as a part of my internship, I was lucky to have direct access to the Tremor developers working at Wayfair whenever I had any questions. We used to have a lot of meetings in the General Voice channel on discord with the Tremor developers and anyone could join in and ask questions, discuss ideas and share what they are working on. This used to be super helpful.</p><p>Apart from that, on the first Tuesday of every month we used to have office hours where everyone joins in and there used to be discussions on topics like: &quot;Why did tremor go open source&quot;, &quot;Good practices for contributing to open-source&quot;, and Q/As. They used to be a lot of fun.</p><p>I am so grateful to my mentors: Darach, Heinz and Matthias for being super kind and always encouraging me to ask questions and clarifying all my doubts. Also, thanks to Ana for always being so nice and helping with my Rust errors. They all are amazing and I thank them for their time and help.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="final-thoughts"></a>Final Thoughts<a class="hash-link" href="#final-thoughts" title="Direct link to heading">#</a></h2><p>It was an overall great journey contributing to Tremor. I learned so much in these 3 months&#x27; time with the support of my mentors. I&#x27;m very grateful to CNCF for organizing this mentorship program as it gave me an opportunity to learn about event processing, distributed systems, Rust, Cloud-Native technologies, etc. I wouldn&#x27;t have learned so much in these 3 months&#x27; time had I not been a part of this mentorship program. It was definitely a fun learning experience.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/connectors">connectors</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/mentorship">mentorship</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/cncf">cncf</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/gpc">gpc</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/tremor-rs/tremor-www/tree/main/blog/2021-06-29T17-LFX-Blog-Jigyasa-gcloud.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/LFX-Blog-Nupur"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Support for the Syslog Protocol</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/02/12/v010-release"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Releasing Tremor v0.10! Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#learning-about-tremor" class="table-of-contents__link">Learning about Tremor</a></li><li><a href="#learning-rust" class="table-of-contents__link">Learning Rust</a></li><li><a href="#my-project" class="table-of-contents__link">My Project</a></li><li><a href="#walk-through-guide" class="table-of-contents__link">Walk-Through Guide</a><ul><li><a href="#google-cloud-storage" class="table-of-contents__link">Google Cloud Storage</a></li><li><a href="#google-cloud-pubsub" class="table-of-contents__link">Google Cloud Pub/sub</a></li></ul></li><li><a href="#testing-for-gsub-onramp-pubsub" class="table-of-contents__link">Testing for gsub onramp (Pub/sub)</a></li><li><a href="#network-failure-recovery" class="table-of-contents__link">Network Failure Recovery</a></li><li><a href="#use-of-connectors" class="table-of-contents__link">Use of Connectors</a></li><li><a href="#the-tremor-community" class="table-of-contents__link">The Tremor community</a></li><li><a href="#final-thoughts" class="table-of-contents__link">Final Thoughts</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/quick-start/">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/community/faqs">FAQs</a></li><li class="footer__item"><a class="footer__link-item" href="/api/0">Tremor API</a></li><li class="footer__item"><a class="footer__link-item" href="/community/governance/CodeofConduct">Code of Conduct</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://chat.tremor.rs/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/TremorDEBS" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/tremor-rs/tremor-runtime/releases" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Download<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.cncf.io/" target="_blank" rel="noreferrer noopener" aria-label="CNCF"><img src="/img/cncf-color.svg" alt="CNCF" style="width: 200px;"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/favicon.ico" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/favicon.ico" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div><div class="footer__copyright">Copyright Â© 2021 Tremor</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c155440f.js"></script>
<script src="/assets/js/main.ea8dcffb.js"></script>
</body>
</html>