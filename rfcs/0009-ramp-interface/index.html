<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tremor Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tremor Blog Atom Feed"><title data-react-helmet="true">Tremor</title><meta data-react-helmet="true" property="og:title" content="Tremor"><meta data-react-helmet="true" property="og:url" content="https://www.tremor.rs//rfcs/0009-ramp-interface"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/docs/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.tremor.rs//rfcs/0009-ramp-interface"><link data-react-helmet="true" rel="alternate" href="https://www.tremor.rs//rfcs/0009-ramp-interface" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.tremor.rs//rfcs/0009-ramp-interface" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.64b546b3.css">
<link rel="preload" href="/assets/js/runtime~main.e7948ec0.js" as="script">
<link rel="preload" href="/assets/js/main.c55a2c90.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://tremor-rs.github.io/tremor-new-website/" target="_self" rel="noopener noreferrer" class="navbar__brand"><img src="/img/tremor-logo.png" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/tremor-logo.png" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/getting-started/about/">About Us</a><a class="navbar__item navbar__link" href="/docs/index">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/quick-start">Usage Guide</a><a class="navbar__item navbar__link" href="/api/0">API</a><a class="navbar__item navbar__link" href="/rfcs/rfcs">RFCs</a><a class="navbar__item navbar__link" href="/community/community">Community</a><a class="navbar__item navbar__link" href="/governance">Governance</a><a class="navbar__item navbar__link" href="/faqs">FAQs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub">GitHub</a><div class="searchWrapper_3rmH"><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://tremor-rs.github.io/tremor-new-website/" target="_self" rel="noopener noreferrer" class="navbar__brand"><img src="/img/tremor-logo.png" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/tremor-logo.png" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/getting-started/about/">About Us</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/index">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/quick-start">Usage Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/api/0">API</a></li><li class="menu__list-item"><a class="menu__link" href="/rfcs/rfcs">RFCs</a></li><li class="menu__list-item"><a class="menu__link" href="/community/community">Community</a></li><li class="menu__list-item"><a class="menu__link" href="/governance">Governance</a></li><li class="menu__list-item"><a class="menu__link" href="/faqs">FAQs</a></li><li class="menu__list-item"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper mdx-wrapper mdx-page"><main><div class="container container--fluid"><div class="margin-vert--lg padding-vert--lg"><div class="row"><div class="col col--8 col--offset-2"><div class="container"><ul><li>Feature Name: ramp-interface</li><li>Start Date: 2020-03-09</li><li>Tremor Issue: <a href="https://github.com/tremor-rs/tremor-runtime/issues/108" target="_blank" rel="noopener noreferrer">tremor-rs/tremor-runtime#0108</a> TBD</li><li>RFC PR: <a href="https://github.com/tremor-rs/tremor-rfcs/pull/0018" target="_blank" rel="noopener noreferrer">tremor-rs/tremor-rfcs#0018</a></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ramp-interface"></a>Ramp Interface<a class="hash-link" href="#ramp-interface" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>This RFC proposes a generalised interface for onramps(sources) and offramps(sinks). This interface can serve as a basis for the PDK as it unifies how Tremor core addresses ramps. As a second benefit, it could serve as a de facto standard for sources and sinks in the broader Rust event processing ecosystem.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="motivation"></a>Motivation<a class="hash-link" href="#motivation" title="Direct link to heading">#</a></h2><p>The <a href="https://rfcs.tremor.rs/0006-plugin-development-kit/" target="_blank" rel="noopener noreferrer">RFC 0006</a> outlines the need and plan to implement a plugin development kit allowing decoupling parts of Tremor to make development less centered around a single artefact.</p><p>To enable plugins, plugins of the same type need to share a standard interface over which they communicate with the outside world. As of today, ramps are the least standardised component in Tremor where each ramp, in no small degree, &quot;does its own thing.&quot; A standardised interface paves the way to implement ramps in the PDK.</p><p>The secondary motivation is that there is an emerging event processing ecosystem in the Rust world, providing a standardised interface that helps code reusability, quality, and sharing. For example, sharing code with timber.io&#x27;s Vector project could become possible.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="guide-level-explanation"></a>Guide-level Explanation<a class="hash-link" href="#guide-level-explanation" title="Direct link to heading">#</a></h2><p>We introduce a Sink and a Source trait. Those traits abstract over the following parts:</p><ul><li>Configuration.</li><li>Data handling.</li><li>Status handling (errors, failures, backpressure for sinks).</li><li>Lifetime management (initialisation and shutdown).</li><li>Event handoff (either to or from the onramp).</li><li>Circuit breaker control/signals/events.</li><li>Support for guaranteed delivery.</li></ul><p>These interface changes trigger a redesign of the current codecs and pre/post processors as they would likely be outside of the scope of a sink or source.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reference-level-explanation"></a>Reference-level Explanation<a class="hash-link" href="#reference-level-explanation" title="Direct link to heading">#</a></h2><p>We should discuss the communication design at this part to provide reasoning as to why it is sound.</p><p>To enable circuit breakers and guaranteed delivery, we need to communicate from a source through a pipeline to an offramp. This model comes with a challenge of a possible live lock at the source and pipeline level. To elaborate, we look at the source as an example. The loop of communication creates the possibility that the source sends an event to the pipeline, blocking at a full queue. At the same time, the pipeline sends an insight to the source, also blocking at a full queue, and thus locking forever.</p><p>To resolve the lock, we use an unbounded queue for insights. Without additional guarantees, unbounded queues hold the risk of uncontrolled risk. In the implementation, we guard against that in two ways so we can guarantee a sound implementation:</p><ol><li><p>In both pipelines and sources, we always process insights first, so forward flow only happens when there is no contraflow remaining to process. By that, we guarantee that before we send an event, we drain all pending insights (and their unbounded queues).</p></li><li><p>Events create insights. Neither sinks nor pipelines can create an insight without a corresponding event. If no events flow forward, there is a finite number of insights to be processed; so while we use unbounded queues, we bound the number of insights that can exist between two events.</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="drawbacks"></a>Drawbacks<a class="hash-link" href="#drawbacks" title="Direct link to heading">#</a></h2><p>Generalised sinks and sources are less specialised than custom-built ones. The chances are good that it complicates some of the implementations and can have a slight negative impact on performance.</p><p>The implementation lends itself to adopt an async-based implementation. A move from threads to async tasks puts a performance penalty on single pipeline deployments. The trade-off here is that an async implementation lends itself to higher concurrency situations and is less impacted when there are many more pipelines or ramps than available cores. Looking down the roadmap, this does provide the characteristics we need for clustering.</p><p>To put this in numbers here, a comparison of 0.8.0 compared with the async implementation. To do this, we ran the test with three physical cores and 42 threads (24 cores + 24 threads). We then run both 0.8.0 and current with 1, 2, 4, 8, 16, 32, and 64 pipelines and onramps against a single blackhole offramp and the throughput recorded.</p><table><thead><tr><th align="right">MB/s</th><th align="right">0.8 - 3</th><th align="right">cur - 3</th><th align="right">0.8 - 48</th><th align="right">cur - 48</th></tr></thead><tbody><tr><td align="right">1</td><td align="right">346.3</td><td align="right">273.8</td><td align="right">155.4</td><td align="right">128.6</td></tr><tr><td align="right">2</td><td align="right">303.9</td><td align="right">339.1</td><td align="right">261.2</td><td align="right">292.3</td></tr><tr><td align="right">4</td><td align="right">210.8</td><td align="right">342.7</td><td align="right">175.2</td><td align="right">234.2</td></tr><tr><td align="right">8</td><td align="right">78.2</td><td align="right">308.3</td><td align="right">163.6</td><td align="right">209.9</td></tr><tr><td align="right">16</td><td align="right">27.0</td><td align="right">265.6</td><td align="right">174.1</td><td align="right">210.9</td></tr><tr><td align="right">32</td><td align="right">8.2</td><td align="right">245.9</td><td align="right">173.0</td><td align="right">201.2</td></tr><tr><td align="right">64</td><td align="right">1.4</td><td align="right">229.8</td><td align="right">154.4</td><td align="right">197.4</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rationale-and-alternatives"></a>Rationale and Alternatives<a class="hash-link" href="#rationale-and-alternatives" title="Direct link to heading">#</a></h2><p>First of all, not generalising ramps excludes them from the PDK.</p><p>The second rationale and alternative is the choice between a strictly threaded and an asynchronous model already described in the drawbacks section. It also details why the negative impact on single-threaded performance is a worthwhile trade-off.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="prior-art"></a>Prior Art<a class="hash-link" href="#prior-art" title="Direct link to heading">#</a></h2><p>Generalised interfaces are a typical pattern. One example is the <a href="https://github.com/ring-clojure/ring" target="_blank" rel="noopener noreferrer">ring</a>, a common abstraction over web applications that allows the reuse of shared parts and logic. Other applications and domains use the same principle to create a more extensive ecosystem around a concept.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="unresolved-questions"></a>Unresolved Questions<a class="hash-link" href="#unresolved-questions" title="Direct link to heading">#</a></h2><p>This RFC does not address linked on/offramps since they are a particular case.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="future-possibilities"></a>Future Possibilities<a class="hash-link" href="#future-possibilities" title="Direct link to heading">#</a></h2><p>A further opportunity is to extend the concept of generalised ramps to linked on and offramps.</p><p>For the time being, Sinks and Sources exist as abstractions under the Onramp/Offramp model. We can remove this abstraction when we have ensured the model works with linked ramps.</p></div></div><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link">Summary</a></li><li><a href="#motivation" class="table-of-contents__link">Motivation</a></li><li><a href="#guide-level-explanation" class="table-of-contents__link">Guide-level Explanation</a></li><li><a href="#reference-level-explanation" class="table-of-contents__link">Reference-level Explanation</a></li><li><a href="#drawbacks" class="table-of-contents__link">Drawbacks</a></li><li><a href="#rationale-and-alternatives" class="table-of-contents__link">Rationale and Alternatives</a></li><li><a href="#prior-art" class="table-of-contents__link">Prior Art</a></li><li><a href="#unresolved-questions" class="table-of-contents__link">Unresolved Questions</a></li><li><a href="#future-possibilities" class="table-of-contents__link">Future Possibilities</a></li></ul></div></div></div></div></div></main></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/quick-start/">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/faqs/">FAQs</a></li><li class="footer__item"><a class="footer__link-item" href="/api/">Tremor API</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/governance/CodeOfConduct/">Code of Conduct</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://chat.tremor.rs/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/TremorDEBS" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://github.com/tremor-rs/tremor-runtime/releases" target="_blank" rel="noopener noreferrer" class="footer__link-item">Download</a></li><li class="footer__item"><a href="https://www.cncf.io/" target="_blank" rel="noreferrer noopener" aria-label="CNCF"><img src="cncf-color.svg" alt="CNCF"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/favicon.ico" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/favicon.ico" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div><div class="footer__copyright">Copyright Â© 2021 Tremor</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e7948ec0.js"></script>
<script src="/assets/js/main.c55a2c90.js"></script>
</body>
</html>