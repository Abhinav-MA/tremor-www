"use strict";(self.webpackChunknew_tremor_website=self.webpackChunknew_tremor_website||[]).push([[3059],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return c}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=p(n),c=r,k=u["".concat(s,".").concat(c)]||u[c]||m[c]||i;return n?a.createElement(k,l(l({ref:t},d),{},{components:n})):a.createElement(k,l({ref:t},d))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},83662:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},metadata:function(){return s},toc:function(){return p},default:function(){return m}});var a=n(87462),r=n(63366),i=(n(67294),n(3905)),l=["components"],o={id:"offramps",title:"Offramps"},s={unversionedId:"artefacts/offramps",id:"artefacts/offramps",isDocsHomePage:!1,title:"Offramps",description:"Specify how tremor connects to the outside world in order to publish to external systems.",source:"@site/docs/artefacts/offramps.md",sourceDirName:"artefacts",slug:"/artefacts/offramps",permalink:"/tremor-new-website/docs/artefacts/offramps",editUrl:"https://github.com/tremor-rs/tremor-new-website/tree/main/docs/artefacts/offramps.md",version:"current",frontMatter:{id:"offramps",title:"Offramps"},sidebar:"tutorialSidebar",previous:{title:"Codecs",permalink:"/tremor-new-website/docs/artefacts/codecs"},next:{title:"Onramps",permalink:"/tremor-new-website/docs/artefacts/onramps"}},p=[{value:"Delivery Properties",id:"delivery-properties",children:[]},{value:"System Offramps",id:"system-offramps",children:[{value:"system::stdout",id:"systemstdout",children:[]},{value:"system::stderr",id:"systemstderr",children:[]}]},{value:"Supported Offramps",id:"supported-offramps",children:[{value:"amqp",id:"amqp",children:[]},{value:"blackhole",id:"blackhole",children:[]},{value:"cb",id:"cb",children:[]},{value:"debug",id:"debug",children:[]},{value:"dns",id:"dns",children:[]},{value:"elastic",id:"elastic",children:[]},{value:"exit",id:"exit",children:[]},{value:"file",id:"file",children:[]},{value:"gcs",id:"gcs",children:[]},{value:"gpub",id:"gpub",children:[]},{value:"Kafka",id:"kafka",children:[]},{value:"kv",id:"kv",children:[]},{value:"nats",id:"nats",children:[]},{value:"newrelic",id:"newrelic",children:[]},{value:"otel",id:"otel",children:[]},{value:"PostgreSQL",id:"postgresql",children:[]},{value:"rest",id:"rest",children:[]},{value:"stderr",id:"stderr",children:[]},{value:"stdout",id:"stdout",children:[]},{value:"tcp",id:"tcp",children:[]},{value:"udp",id:"udp",children:[]},{value:"ws",id:"ws",children:[]}]}],d={toc:p};function m(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Specify how tremor connects to the outside world in order to publish to external systems."),(0,i.kt)("p",null,"For example, the Elastic offramp pushes data to ElasticSearch via its bulk upload REST/HTTP API endpoint."),(0,i.kt)("p",null,"All ",(0,i.kt)("inlineCode",{parentName:"p"},"offramps")," are specified in the following form:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: <unique offramp id>\n    type: <offramp name>\n    codec: <codec of the data>\n    postprocessors: # can be omitted\n      - <postprocessor 1>\n      - <postprocessor 2>\n      - ...\n    preprocessors: # only for linked transport, can be omitted\n      - <preprocessor 1>\n      - <preprocessor 2>\n      - ...\n    linked: <true or false> # enable linked transport, default: false\n    codec_map:\n      "<mime-type>": "<codec handling the given mime-type>"\n    config:\n      <key>: <value>\n')),(0,i.kt)("h2",{id:"delivery-properties"},"Delivery Properties"),(0,i.kt)("p",null,"Each offramp is able to report events as being definitely sent off or as failed. It can also report itself as not functional anymore to the connected pipelines. How each offramp implements those abilities is described in the table below."),(0,i.kt)("p",null,"The column ",(0,i.kt)("inlineCode",{parentName:"p"},"Delivery acknowledgements")," describes under what circumstances the offramp considers an event delivered and acknowledges it to the connected pipelines and operators, onramps etc. therein.\nAcknowledgements, Failures or missing Acknowledgements take effect e.g. when using the operators or onramps that support those mechanisms (e.g. the WAL operator or the Kafka onramp)."),(0,i.kt)("p",null,"The column ",(0,i.kt)("inlineCode",{parentName:"p"},"Disconnect events")," describes under which circumstances this offramp is not considered functional anymore."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Offramp"),(0,i.kt)("th",{parentName:"tr",align:null},"Disconnect events"),(0,i.kt)("th",{parentName:"tr",align:null},"Delivery acknowledgements"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"amqp"),(0,i.kt)("td",{parentName:"tr",align:null},"never"),(0,i.kt)("td",{parentName:"tr",align:null},"always")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"blackhole"),(0,i.kt)("td",{parentName:"tr",align:null},"never"),(0,i.kt)("td",{parentName:"tr",align:null},"always")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"cb"),(0,i.kt)("td",{parentName:"tr",align:null},"never"),(0,i.kt)("td",{parentName:"tr",align:null},"always")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"debug"),(0,i.kt)("td",{parentName:"tr",align:null},"never"),(0,i.kt)("td",{parentName:"tr",align:null},"always")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"dns"),(0,i.kt)("td",{parentName:"tr",align:null},"never"),(0,i.kt)("td",{parentName:"tr",align:null},"always")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"elastic"),(0,i.kt)("td",{parentName:"tr",align:null},"connection loss"),(0,i.kt)("td",{parentName:"tr",align:null},"on 200 replies")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"exit"),(0,i.kt)("td",{parentName:"tr",align:null},"never"),(0,i.kt)("td",{parentName:"tr",align:null},"always")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"file"),(0,i.kt)("td",{parentName:"tr",align:null},"never"),(0,i.kt)("td",{parentName:"tr",align:null},"always")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"gcs"),(0,i.kt)("td",{parentName:"tr",align:null},"connection loss"),(0,i.kt)("td",{parentName:"tr",align:null},"on successful send")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"gpub"),(0,i.kt)("td",{parentName:"tr",align:null},"connection loss"),(0,i.kt)("td",{parentName:"tr",align:null},"on successful send")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"kafka"),(0,i.kt)("td",{parentName:"tr",align:null},"see librdkafka"),(0,i.kt)("td",{parentName:"tr",align:null},"see librdkafka")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"kv"),(0,i.kt)("td",{parentName:"tr",align:null},"never"),(0,i.kt)("td",{parentName:"tr",align:null},"always")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"nats"),(0,i.kt)("td",{parentName:"tr",align:null},"connection loss"),(0,i.kt)("td",{parentName:"tr",align:null},"always")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"newrelic"),(0,i.kt)("td",{parentName:"tr",align:null},"never"),(0,i.kt)("td",{parentName:"tr",align:null},"never")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"otel"),(0,i.kt)("td",{parentName:"tr",align:null},"connection loss"),(0,i.kt)("td",{parentName:"tr",align:null},"on successful delivery")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Postgres"),(0,i.kt)("td",{parentName:"tr",align:null},"never"),(0,i.kt)("td",{parentName:"tr",align:null},"always")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"rest"),(0,i.kt)("td",{parentName:"tr",align:null},"connection loss"),(0,i.kt)("td",{parentName:"tr",align:null},"on non 4xx/5xx replies")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"stderr"),(0,i.kt)("td",{parentName:"tr",align:null},"never"),(0,i.kt)("td",{parentName:"tr",align:null},"always")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"stdout"),(0,i.kt)("td",{parentName:"tr",align:null},"never"),(0,i.kt)("td",{parentName:"tr",align:null},"always")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"tcp"),(0,i.kt)("td",{parentName:"tr",align:null},"connection loss"),(0,i.kt)("td",{parentName:"tr",align:null},"on send")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"udp"),(0,i.kt)("td",{parentName:"tr",align:null},"local socket loss"),(0,i.kt)("td",{parentName:"tr",align:null},"on send")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ws"),(0,i.kt)("td",{parentName:"tr",align:null},"connection loss"),(0,i.kt)("td",{parentName:"tr",align:null},"on send")))),(0,i.kt)("h2",{id:"system-offramps"},"System Offramps"),(0,i.kt)("p",null,"Each tremor runtime comes with some pre-configured ",(0,i.kt)("inlineCode",{parentName:"p"},"offramps")," that can be used."),(0,i.kt)("h3",{id:"systemstdout"},"system::stdout"),(0,i.kt)("p",null,"The offramp ",(0,i.kt)("inlineCode",{parentName:"p"},"/offramp/system::stdout/system")," can be used to print to STDOUT. Data will be formatted as JSON."),(0,i.kt)("h3",{id:"systemstderr"},"system::stderr"),(0,i.kt)("p",null,"The offramp ",(0,i.kt)("inlineCode",{parentName:"p"},"/offramp/system::stderr/system")," can be used to print to STDERR. Data will be formatted as JSON."),(0,i.kt)("h2",{id:"supported-offramps"},"Supported Offramps"),(0,i.kt)("h3",{id:"amqp"},"amqp"),(0,i.kt)("p",null,"The amqp offramp publishes AMQP messages to an ",(0,i.kt)("a",{parentName:"p",href:"https://www.amqp.org"},"AMQP")," broker. It uses ",(0,i.kt)("a",{parentName:"p",href:"https://docs.rs/lapin/1.6.8/lapin/"},"lapin")," for an AMQP 0.9.1 protocol implementation."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: amqp\n    type: amqp\n    config:\n      amqp_addr: "amqp://guest:guest@127.0.0.1:5672/"\n      exchange: ""\n      routing_key: "hello"\n      publish_options:\n        immediate: true\n        mandatory: false\n')),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"amqp_addr")," - an AMQP URI as string, required. For more details see ",(0,i.kt)("a",{parentName:"li",href:"https://www.rabbitmq.com/uri-spec.html"},"AMQP 0.9.1 URI spec"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"exchange")," - The exchange to publish messages to. Format: String, optional, defaults to the empty string and then publish to the default exchange."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"routing_key")," - Specifies the routing key for the message. The routing key is used for routing messages depending on the exchange configuration. Format: String, optional, defaults to the empty string."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"publish_options")," - Required config that controls what happens when a message cannot be routed to a queue",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"immediate")," - This flag tells the server how to react if the message cannot be routed to a queue consumer immediately. If this flag is ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),", the server will return an undeliverable message with a Return method. If this flag is ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),", the server will queue the message, but with no guarantee that it will ever be consumed. Default: ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"mandatory")," - This flag tells the server how to react if the message cannot be routed to a queue. If this flag is ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),", the server will return an unroutable message with a Return method. If this flag is false, the server silently drops the message. Default: ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),".")))),(0,i.kt)("p",null,"Events are published (after being serialized and possibly chunked codec and postprocessors) as AMQP Messages to the specified ",(0,i.kt)("inlineCode",{parentName:"p"},"exchange")," (empty string is the default exchange) using the specified routing key."),(0,i.kt)("p",null,"This offramp uses the AMQP 0.9.1 ",(0,i.kt)("a",{parentName:"p",href:"https://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish"},"basic-publish operation"),"."),(0,i.kt)("h3",{id:"blackhole"},"blackhole"),(0,i.kt)("p",null,"The blackhole offramp is used for benchmarking it takes measurements of the end to end times of each event traversing the pipeline and at the end prints an HDR ( High Dynamic Range ) ",(0,i.kt)("a",{parentName:"p",href:"http://hdrhistogram.org/"},"histogram"),"."),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"warmup_secs")," - Number of seconds after startup in which latency won't be measured to allow for a warmup delay."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"stop_after_secs")," - Stop tremor after a given number of seconds and print the histogram."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"significant_figures")," - Significant figures for the HDR histogram. (the first digits of each measurement that are kept as precise values)")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"offramp:\n  - id: bh\n    type: blackhole\n    config:\n      warmup_secs: 10\n      stop_after_secs: 40\n")),(0,i.kt)("h3",{id:"cb"},"cb"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"cb")," is short for circuit breaker. This offramp can be used to trigger certain circuit breaker events manually by sending the intended circuit breaker event in the event metadata or the event data.\nSupported payloads are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"ack"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"fail"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"trigger")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"close"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"open")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"restore")),(0,i.kt)("p",{parentName:"li"},"No matter how many ",(0,i.kt)("inlineCode",{parentName:"p"},"ack")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"fail")," strings the ",(0,i.kt)("inlineCode",{parentName:"p"},"cb")," key contains, only ever one ",(0,i.kt)("inlineCode",{parentName:"p"},"ack")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"fail")," CB event will be emitted, to stay within the CB protocol.\nThe same is true for ",(0,i.kt)("inlineCode",{parentName:"p"},"trigger"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"close")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"open"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"restore")," strings, only one of those two will be emitted, never more."),(0,i.kt)("p",{parentName:"li"},"Example config:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"}," offramp:\n   - id: cb_tester\n     type: cb\n")),(0,i.kt)("p",null,"Example payloads:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "cb": "ack",\n  "some_other_field": true\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "cb": ["fail", "close"]\n}\n')),(0,i.kt)("p",null,"Such an event or metadata will result in two CB insight events be sent back, one ",(0,i.kt)("inlineCode",{parentName:"p"},"fail")," event, and one ",(0,i.kt)("inlineCode",{parentName:"p"},"close")," event."),(0,i.kt)("h3",{id:"debug"},"debug"),(0,i.kt)("p",null,"The debug offramp is used to get an overview of how many events are put in which classification."),(0,i.kt)("p",null,"This operator does not support configuration."),(0,i.kt)("p",null,"Used metadata variables:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$class")," - Class of the event to count by. (optional)")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"offramp:\n  - id: dbg\n    type: debug\n")),(0,i.kt)("h3",{id:"dns"},"dns"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"dns")," linked offramp allows performing DNS queries against the system resolver."),(0,i.kt)("p",null,"::note\nNo codecs, configuration, or processors are supported.\n:::"),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"  - id: dns\n    type: dns\n")),(0,i.kt)("p",null,"The event needs the following structure:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "lookup": "tremor.rs"\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "lookup": {\n    "name": "tremor.rs",\n    "type": "CNAME"\n  }\n}\n')),(0,i.kt)("p",null,"where type can be one of (please consult your DNS manual for the meaning of each):"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"A")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"AAAA")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ANAME")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"CNAME")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"TXT")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"PTR")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"CAA")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"HINFO")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"HTTPS")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"MX")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"NAPTR")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"NULL")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"NS")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"OPENPGPKEY")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SOA")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SRV")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SSHFP")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SVCB")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"TLSA"))),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If type is not specified ",(0,i.kt)("inlineCode",{parentName:"p"},"A")," records will be looked up"))),(0,i.kt)("p",null,"Responses are an Array of objects denoting the type of record found as a key, followed by the entry as a string and a ",(0,i.kt)("inlineCode",{parentName:"p"},"ttl")," for the record (please consult your DNS manual for the return value of different record types):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {"A": "1.2.3.4", "ttl": 60},\n  {"CNAME": "www.tremor.rs", "ttl": 120}\n]\n')),(0,i.kt)("h3",{id:"elastic"},"elastic"),(0,i.kt)("p",null,"The elastic offramp writes to one or more ElasticSearch nodes. This is currently tested with ES v6 and v7."),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"nodes")," - A list of elastic search nodes to contact. These are the nodes to which tremor will send traffic to."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"concurrency")," - Maximum number of parallel requests (default: 4).")),(0,i.kt)("p",null,"Events will be sent to the connected ElasticSearch cluster via the ",(0,i.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html"},"ES Bulk API")," using the ",(0,i.kt)("inlineCode",{parentName:"p"},"index")," action.\nIt is recommended to batch events sent to this sink using the ",(0,i.kt)("a",{parentName:"p",href:"/tremor-new-website/docs/tremor-query/operators#genericbatch"},"generic::batch operator")," to reduce the overhead\nintroduced by the ",(0,i.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html"},"ES Bulk API"),"."),(0,i.kt)("p",null,"The configuration options ",(0,i.kt)("inlineCode",{parentName:"p"},"codec")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"postprocessors")," are not used, as elastic will always serialize event payloads as JSON."),(0,i.kt)("p",null,"If the number of parallel requests surpass ",(0,i.kt)("inlineCode",{parentName:"p"},"concurrency"),", an error event will be emitted to the ",(0,i.kt)("inlineCode",{parentName:"p"},"err")," port, which can be used for appropriate error handling."),(0,i.kt)("p",null,"The following metadata variables can be specified on a per event basis:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},'$elastic["_index"]')," - The index to write to (required)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},'$elastic["_type"]')," - The document type for elastic (optional), deprecated in ES 7."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},'$elastic["_id"]'),"   - The document id for elastic (optional)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$elastic.pipeline")," - The ElasticSearch pipeline to use (optional)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$elastic.action")," - The ",(0,i.kt)("a",{parentName:"li",href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html"},"bulk action")," to perform, one of ",(0,i.kt)("inlineCode",{parentName:"li"},"delete"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"create"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"update")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"index"),". If no ",(0,i.kt)("inlineCode",{parentName:"li"},"action")," is provided it defaults to ",(0,i.kt)("inlineCode",{parentName:"li"},"index"),". ",(0,i.kt)("inlineCode",{parentName:"li"},"delete")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"update")," require ",(0,i.kt)("inlineCode",{parentName:"li"},"$elastic._id")," to be set or elastic search will have error.")),(0,i.kt)("h4",{id:"linked-transport"},"Linked Transport"),(0,i.kt)("p",null,"If used as a linked transport, the sink will emit events in case of errors sending data to ES or if the incoming event is malformed via the ",(0,i.kt)("inlineCode",{parentName:"p"},"err")," port.\nAlso, upon a returned ES Bulk request, it will emit an event for each bulk item, denoting success or failure."),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Success Responses")),(0,i.kt)("p",null,"Events denoting success are sent via the ",(0,i.kt)("inlineCode",{parentName:"p"},"out")," port and have the following format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "success": true,\n  "source": {\n    "event_id": "1:2:3",\n    "origin": "file:///tmp/input.json.xz"\n  },\n  "payload": {}\n}\n')),(0,i.kt)("p",null,"The event metadata will contain the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "elastic": {\n    "_id": "ES document id",\n    "_type": "ES document type",\n    "_index": "ES index",\n    "version": "ES document version"\n  }\n}\n')),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Error Responses")),(0,i.kt)("p",null,"Events denoting bulk item failure are sent via the ",(0,i.kt)("inlineCode",{parentName:"p"},"err")," port and have the following format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "success": false,\n  "source": {\n    "event_id": "2:3:4",\n    "origin": null\n  },\n  "error": {},\n  "payload": {}\n}\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"error")," will contain the error description object returned from ES."),(0,i.kt)("p",null,"The event metadata for failed events looks as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "elastic": {\n    "_id": "ES document id",\n    "_type": "ES document type",\n    "_index": "ES index",\n  }\n}\n')),(0,i.kt)("p",null,"Error Responses that are not scoped to bulk items, but the whole operation of turning the event into a Elasticsearch Bulk Request and sending that request to Elasticsearch\nwill have the same payload format as Bulk item errors, but the ",(0,i.kt)("inlineCode",{parentName:"p"},"$elastic")," metadata is missing:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "success": false,\n  "source": {\n    "event_id": "2:3:4",\n    "origin": "tremor-rest://example.org/"\n  },\n  "error": {},\n  "payload": {}\n}\n')),(0,i.kt)("p",null,"For both error and success responses ",(0,i.kt)("inlineCode",{parentName:"p"},"payload")," is the event payload that was sent to ES."),(0,i.kt)("p",null,"Example Configuration:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"offramp:\n  - id: es\n    type: elastic\n    config:\n      nodes:\n        - http://elastic:9200\n")),(0,i.kt)("p",null,"Example Configuration for linked transport (including binding):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: es-linked\n    type: elastic\n    linked: true\n    config:\n      nodes:\n        - http://elastic1:9200\n        - http://elastic2:9200\n      concurrency: 8\n\nbinding:\n  id: "es-linked-binding"\n  links:\n    "/onramp/example/{instance}/out": ["/pipeline/to_elastic/{instance}/in"]\n    "/pipeline/to_elastic/{instance}/in": ["/offramp/es-linked/{instance}/in"]\n\n    # handle success and error messages with different pipelines\n    "/offramp/es-linked/{instance}/out": ["/pipeline/handle-es-success/{instance}/in"]\n    "/offramp/es-linked/{instance}/err": ["/pipeline/handle-es-error/{instance}/in"]\n\n    # more links...\n    ...\n\n')),(0,i.kt)("h3",{id:"exit"},"exit"),(0,i.kt)("p",null,"The exit offramp terminates the runtime with a system exit status."),(0,i.kt)("p",null,"The offramp accepts events via its standard input port and responds\nto events with a record structure containing a numeric exit field."),(0,i.kt)("p",null,"To indicate successful termination, an ",(0,i.kt)("inlineCode",{parentName:"p"},"exit")," status of zero may be used:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{ "exit": 0 }\n')),(0,i.kt)("p",null,"To indicate non-successful termination, a non-zero ",(0,i.kt)("inlineCode",{parentName:"p"},"exit")," status may be used:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{ "exit": 1 }\n')),(0,i.kt)("p",null,"Exit codes should follow standard UNIX/Linux guidelines when being integrated\nwith ",(0,i.kt)("inlineCode",{parentName:"p"},"bash")," or other shell-based environments, as follows:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Code"),(0,i.kt)("th",{parentName:"tr",align:null},"Meaning"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"Success")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"General errors")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"2"),(0,i.kt)("td",{parentName:"tr",align:null},"Misuse of builtins")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"126"),(0,i.kt)("td",{parentName:"tr",align:null},"Command invoked cannot run due to credentials/auth constraints")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"127"),(0,i.kt)("td",{parentName:"tr",align:null},"Command not understood, not well-formed or illegal")))),(0,i.kt)("p",null,"To delay the exit (to allow flushing of other ",(0,i.kt)("inlineCode",{parentName:"p"},"offramps"),") the ",(0,i.kt)("inlineCode",{parentName:"p"},"delay")," key can be used to delay the exit by a number of milliseconds:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "exit": 1,\n  "delay": 1000\n}\n')),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"offramp:\n  - id: terminate\n    type: exit\n")),(0,i.kt)("h3",{id:"file"},"file"),(0,i.kt)("p",null,"The file offramp writes events to a file, one event per line. The file is overwritten if it exists."),(0,i.kt)("p",null,"The default ",(0,i.kt)("a",{parentName:"p",href:"/tremor-new-website/docs/artefacts/codecs#json"},"codec")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"json"),"."),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"file")," - The file to write to.")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"offramp:\n  - id: in\n    type: file\n    config:\n      file: /my/path/to/a/file.json\n")),(0,i.kt)("h3",{id:"gcs"},"gcs"),(0,i.kt)("p",null,"Google Cloud Storage offramp."),(0,i.kt)("p",null,"This offramp can issue basic operations to list buckets and objects and to create, insert and delete objects from the Google Cloud Platform cloud storage service."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The offramp is experimental."))),(0,i.kt)("p",null,"This offramp assumes that the environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"GOOGLE_APPLICATION_CREDENTIALS")," been exported to the execution environment and it has been configured to point to a valid non-expired service account token json file."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"offramp:\n  - id: gcs\n    type: gcs\n    codec: json\n    linked: true\n    postprocessors:\n      - gzip\n    preprocessors:\n      - gzip\n")),(0,i.kt)("p",null,"If the use case for the offramp requires metadata from the Google Cloud Storage service on the supported operations for this offramp, then set linked to true and configure the output port ",(0,i.kt)("inlineCode",{parentName:"p"},"out"),".\nIf the use case does not require metadata, then set linked to false."),(0,i.kt)("h4",{id:"list_buckets"},"list_buckets"),(0,i.kt)("p",null,"Lists all the buckets in the Google Cloud Storage project."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n "command": "list_buckets",\n "project_id": "<project-id>"\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'[\n  {\n    "cmd": "list_buckets",\n    "data": {\n      "items": [\n        {\n          "location": "EU",\n          "id": "<bucket-id>",\n          "locationType": "multi-region",\n          "storageClass": "STANDARD",\n          "metageneration": "4",\n          "selfLink": "https://www.googleapis.com/storage/v1/b/<bucket-id>",\n          "kind": "storage#bucket",\n          "name": "<bucket-name>",\n          "timeCreated": "<time of creation>",\n          "iamConfiguration": {\n            "uniformBucketLevelAccess": {\n              "enabled": true,\n              "lockedTime": "2021-06-17T09:12:22.122Z"\n            },\n            "bucketPolicyOnly": {\n              "enabled": true,\n              "lockedTime": "2021-06-17T09:12:22.122Z"\n            }\n          },\n          "etag": "CAQ=",\n          "defaultEventBasedHold": false,\n          "retentionPolicy": {\n            "effectiveTime": "2021-03-19T09:12:22.122Z",\n            "retentionPeriod": "60",\n            "isLocked": false\n          },\n          "updated": "2021-04-13T17:05:29.404Z",\n          "satisfiesPZS": false,\n          "projectNumber": "<project-number>"\n        }\n      ],\n      "kind": "storage#buckets"\n    }\n  }\n]\n\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Where"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<project-id>")," - The project id of the Google Cloud Storage project where the buckets are."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<bucket-id>")," - The unique identifier of the bucket."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<project-number>")," - The project number for the Google Cloud Storage project.")),(0,i.kt)("h4",{id:"list_objects"},"list_objects"),(0,i.kt)("p",null,"Lists all the objects in the specified bucket."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "command": "list_objects",\n  "bucket": "<bucket-name>"\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'[\n  {\n    "cmd": "list_objects",\n    "data": {\n      "items": [\n        {\n          "mediaLink": "",\n          "bucket": "<bucket-name>",\n          "id": "<object-id>",\n          "size": "1943550",\n          "crc32c": "0QXXmA==",\n          "storageClass": "STANDARD",\n          "generation": "1616145246990906",\n          "metageneration": "1",\n          "timeStorageClassUpdated": "2021-03-19T09:14:07.012Z",\n          "selfLink": "",\n          "kind": "storage#object",\n          "name": "<object-name>",\n          "md5Hash": "ucrP5b1N+6JHxn1TKavn/A==",\n          "timeCreated": "2021-03-19T09:14:07.012Z",\n          "etag": "CLrk6JqCvO8CEAE=",\n          "updated": "2021-03-19T09:14:07.012Z",\n          "retentionExpirationTime": "2021-03-19T09:15:07.012Z",\n          "contentType": "<content-type>"\n        }\n      ],\n      "kind": "storage#objects"\n    }\n  }\n]\n\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Where"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<bucket-name>")," - The name of the Google Cloud Storage bucket where the object is."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<object-id>")," - The unique object identifier."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<object-name>")," - The name of the object in the Google Cloud Stoarge bucket."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<content-type>")," - The type of the object uploaded.")),(0,i.kt)("h4",{id:"create_bucket"},"create_bucket"),(0,i.kt)("p",null,"Creates a bucket in the project specified in the command."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "command": "create_bucket" ,\n  "project_id": "<project-id>",\n  "bucket": "<bucket>"\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'[\n  {\n    "cmd": "create_bucket",\n    "data": {\n      "projectNumber": "<project-number>",\n      "location": "US",\n      "id": "<bucket-id>",\n      "etag": "CAE=",\n      "locationType": "multi-region",\n      "storageClass": "STANDARD",\n      "metageneration": "1",\n      "updated": "2021-04-22T07:37:23.702Z",\n      "selfLink": "https://www.googleapis.com/storage/v1/b/<bucket-name>",\n      "kind": "storage#bucket",\n      "name": "tremor",\n      "iamConfiguration": {\n        "uniformBucketLevelAccess": {\n          "enabled": false\n        },\n        "bucketPolicyOnly": {\n          "enabled": false\n        }\n      },\n      "timeCreated": "2021-04-22T07:37:23.702Z"\n    }\n  }\n]\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Where"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<project-id>")," - The project id of the Google Cloud Storage project where the bucket is."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<bucket-id>")," - The unique identifier of the bucket."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<project-number>")," - The project number for the Google Cloud Storage project.")),(0,i.kt)("h4",{id:"remove_bucket"},"remove_bucket"),(0,i.kt)("p",null,"Removes the bucket from the specified project in Google Cloud Storage project."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n "command": "remove_bucket",\n "bucket": "<bucket-name>"\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Where"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<bucket-name>")," - The name of the Google Cloud Storage bucket where the object is.")),(0,i.kt)("h4",{id:"upload_object"},"upload_object"),(0,i.kt)("p",null,"Uploads the object to a Google Cloud Storage bucket."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n "command": "upload_object",\n "bucket": "<bucket-name>",\n "object": "<object-name>",\n "body": `<object>`\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'[\n  {\n    "cmd": "upload_object",\n    "data": {\n      "mediaLink": "https://storage.googleapis.com/download/storage/v1/b/<bucket-name>/o/<object-name>?generation=1619077199260663&alt=media",\n      "bucket": "<bucket-name>",\n      "id": "<object-id>",\n      "size": "47",\n      "crc32c": "a7mrxw==",\n      "storageClass": "STANDARD",\n      "generation": "1619077199260663",\n      "metageneration": "1",\n      "timeStorageClassUpdated": "2021-04-22T07:39:59.278Z",\n      "selfLink": "https://www.googleapis.com/storage/v1/b/<bucket-name>/o/<object-name>",\n      "kind": "storage#object",\n      "name": "april",\n      "md5Hash": "qhr9326j+3PeIK9koXMHCg==",\n      "timeCreated": "2021-04-22T07:39:59.278Z",\n      "etag": "CPfXzcqskfACEAE=",\n      "updated": "2021-04-22T07:39:59.278Z",\n      "retentionExpirationTime": "2021-04-22T07:40:59.278Z",\n      "contentType": "application/json"\n    }\n  }\n]\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Where"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<object>")," - The object data to be uploaded to a Google Cloud Storage bucket."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<bucket-name>")," - The name of the Google Cloud Storage bucket where the object is."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<object-id>")," - The unique object identifier."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<object-name>")," - The name of the object in the Google Cloud Stoarge bucket.")),(0,i.kt)("h4",{id:"fetch_object"},"fetch_object"),(0,i.kt)("p",null,"Returns the metadata for the object fetched."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n "command": "fetch",\n "bucket": "<bucket-name>",\n "object": "<object-name>"\n}\n\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'[\n  {\n    "cmd": "fetch",\n    "data": {\n      "mediaLink": "https://storage.googleapis.com/download/storage/v1/b/<bucket-name>/o/<object-name>?generation=1619077199260663&alt=media",\n      "bucket": "<bucket-name>",\n      "id": "<object-id>",\n      "size": "47",\n      "crc32c": "a7mrxw==",\n      "storageClass": "STANDARD",\n      "generation": "1619077199260663",\n      "metageneration": "1",\n      "timeStorageClassUpdated": "2021-04-22T07:39:59.278Z",\n      "selfLink": "https://www.googleapis.com/storage/v1/b/<bucket-name>/o/<object-name>",\n      "kind": "storage#object",\n      "name": "april",\n      "md5Hash": "qhr9326j+3PeIK9koXMHCg==",\n      "timeCreated": "2021-04-22T07:39:59.278Z",\n      "etag": "CPfXzcqskfACEAE=",\n      "updated": "2021-04-22T07:39:59.278Z",\n      "retentionExpirationTime": "2021-04-22T07:40:59.278Z",\n      "contentType": "application/json"\n    }\n  }\n]\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Where"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<bucket-name>")," - The name of the Google Cloud Storage bucket where the object is."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<object-id>")," - The unique object identifier."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<object-name>")," - The name of the object in the Google Cloud Stoarge bucket.")),(0,i.kt)("h4",{id:"download_object"},"download_object"),(0,i.kt)("p",null,"Downloads the object."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "command": "download_object",\n  "bucket": "<bucket-name>",\n  "object": "<object-name>"\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'[\n  {\n    "cmd": "download_object",\n    "data": `<object>`\n  }\n]\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Where"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<bucket-name>")," - The name of the Google Cloud Storage bucket where the object is."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<object-name>")," - The name of the object in the Google Cloud Stoarge bucket."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<object>")," - The object downloaded.")),(0,i.kt)("h4",{id:"remove_object"},"remove_object"),(0,i.kt)("p",null,"Removes the object from the specified bucket."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "command": "remove_object" ,\n  "bucket":"<bucket-name>",\n  "object": "<object-name>"\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Where"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<bucket-name>")," - The name of the Google Cloud Storage bucket where the object is."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<object-name>")," - The name of the object in the Google Cloud Stoarge bucket.")),(0,i.kt)("h3",{id:"gpub"},"gpub"),(0,i.kt)("p",null,"Google Cloud Pubsub - Publisher"),(0,i.kt)("p",null,"This offramp can issue basic operation of creating a subscription and sending a message to a topic."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The offramp is  experimental."))),(0,i.kt)("p",null,"This offramp assumes that the environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"GOOGLE_APPLICATION_CREDENTIALS")," has been exported to the execution environment and it has been configured to point to a valid non-expired service account token json file."),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"pem")," - The pem file from GCP for authentication.")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"offramp:\n  - id: gpub\n    type: gpub\n    codec: json\n    postprocessors:\n      - gzip    \n    linked: true\n    config:\n      pem: gcp.pem\n")),(0,i.kt)("p",null,"If the use case for the offramp requires metadata from the Google Cloud Pub/Sub service on the supported operations for this offramp, then set linked to true and configure the output port ",(0,i.kt)("inlineCode",{parentName:"p"},"out"),". If the use case does not require metadata, then set linked to false."),(0,i.kt)("h4",{id:"create_subscription"},"create_subscription"),(0,i.kt)("p",null,"Create a subsrciption to a pub/sub topic."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "command": "create_subscription",\n  "project": "<project-id>",\n  "topic": "<topic-name>",\n  "subscription": "<subscription-name>",\n  "message_ordering": `<message-ordering>`\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "subscription": "projects/<project-id>/subscriptions/<subscription-name>",\n  "topic": "projects/<project-id>/topics/<topic-name>",\n  "ack_deadline_seconds": `<ack_deadline_seconds>`,\n  "retain_acked_messages": `<retain_acked_messages>`,\n  "enable_message_ordering": `<enable_message_ordering>`,\n  "message_retention_duration": `<message_retention_duration>`,\n  "filter": "<filter>",\n  "detached": `<detached>`\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Where"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<project-id>")," - The project id of the Google Cloud Pub/sub project where the topic is."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<topic-name>")," - The Google cloud Pub/Sub topic name to which the subscription is being created."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<subscription-name>")," - Set a unique name for the subscription to be created."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<message-ordering>")," - Can be set to true or false. To receive the messages in order, set the message ordering property on the subscription you receive messages from. Receiving messages in order might increase latency."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<ack_deadline_seconds>")," - The approximate amount of time (on a best-effort basis) Pub/Sub waits for the subscriber to acknowledge receipt before resending the message. In the interval after the message is delivered and before it is acknowledged, it is considered to be outstanding. During that time period, the message will not be redelivered (on a best-effort basis)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<retain_acked_messages>")," -  Indicates whether to retain acknowledged messages. If true, then messages are not expunged from the subscription's backlog, even if they are acknowledged, until they fall out of the message_retention_duration window."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<enable_message_ordering>")," - If true, messages published with the same ordering_key in PubsubMessage will be delivered to the subscribers in the order in which they are received by the Pub/Sub system. Otherwise, they may be delivered in any order."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<message_retention_duration>")," - How long to retain unacknowledged messages in the subscription's backlog, from the moment a message is published. If retain_acked_messages is true, then this also configures the retention of acknowledged messages, and thus configures how far back in time a Seek can be done. Defaults to 7 days. Cannot be more than 7 days or less than 10 minutes."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<filter>")," - An expression written in the Pub/Sub filter language. If non-empty, then only PubsubMessages whose attributes field matches the filter are delivered on this subscription. If empty, then no messages are filtered out."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<detached>")," - Indicates whether the subscription is detached from its topic. Detached subscriptions don't receive messages from their topic and don't retain any backlog.")),(0,i.kt)("h4",{id:"send_message"},"send_message"),(0,i.kt)("p",null,"Send a message to a pubsub topic."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "command": "send_message", \n  "project": "<project-id>", \n  "topic": "<topic-name>", \n  "data": `<data>`,\n  "ordering_key": "<ordering-key>" \n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "message-id": "<message-id>",\n  "command": "send_message"\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Where"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<project-id>")," - The project id of the Google Cloud Pubsub project where the topic is."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<topic-name>")," - The Google cloud PubSub topic name to which the message is being sent."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<data>")," - The data that is to be sent as message."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<ordering-key>")," - If non-empty, identifies related messages for which publish order should be respected. If a Subscription has message_ordering set to true, messages published with the same non-empty ordering_key value will be delivered to subscribers in the order in which they are received by the pub/sub system. All PubsubMessages published in a given PublishRequest must specify the same ordering_key value. "),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<message-id>")," - The message id assigned by the Google Cloud pub/sub api.")),(0,i.kt)("h3",{id:"kafka"},"Kafka"),(0,i.kt)("p",null,"The Kafka offramp connects sends events to Kafka topics. It uses ",(0,i.kt)("inlineCode",{parentName:"p"},"librdkafka")," to handle connections and can use the full set of ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/edenhill/librdkafka/blob/v1.5.0/CONFIGURATION.md"},"librdkaka 1.5.0 configuration options"),"."),(0,i.kt)("p",null,"The default ",(0,i.kt)("a",{parentName:"p",href:"/tremor-new-website/docs/artefacts/codecs#json"},"codec")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"json"),"."),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"topic")," - The topic to send to."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"brokers")," - Broker servers to connect to. (Kafka nodes)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"hostname")," - Hostname to identify the client with. (default: the systems hostname)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"key")," - Key to use for messages (default: none)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"rdkafka_options")," - An optional map of option to value, where both sides need to be strings.")),(0,i.kt)("p",null,"Used metadata variables:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$kafka")," - Record consisting of the following meta information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$headers"),": A record denoting the ",(0,i.kt)("a",{parentName:"li",href:"https://kafka.apache.org/20/javadoc/index.html?org/apache/kafka/connect/header/Header.html"},"headers")," for the message."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$key"),": Same as config ",(0,i.kt)("inlineCode",{parentName:"li"},"key")," (optional. overrides related config param when present)")))),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"offramp:\n  - id: kafka-out\n    type: kafka\n    config:\n      brokers:\n        - kafka:9092\n      topic: demo\n")),(0,i.kt)("h3",{id:"kv"},"kv"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"kv")," offramp is intended to allow for a decoupled way of persisting and retrieving state in a non blocking way."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"kv")," store is persisted to the directory configured in ",(0,i.kt)("inlineCode",{parentName:"p"},"config.dir"),". If it doesnt exist, it will be created."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'  - id: kv\n    type: kv\n    linked: true     # this needs to be true\n    codec: json\n    config:\n      dir: "temp/kv" # directory to store data in\n')),(0,i.kt)("p",null,"One response event is sent for every command in the handled event. On success to the ",(0,i.kt)("inlineCode",{parentName:"p"},"out")," port, in the error case (malformed data or error during kv operation) to the ",(0,i.kt)("inlineCode",{parentName:"p"},"err")," port.\nEach response event will have the following metadata structure:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "kv": {\n    "op": "<string>|null" // contains the command key that was used to trigger this response, can be `null` for error events.\n  }\n}\n\nEvents sent to the KV offramp contain commands. The following are supported:\n\n#### get\n\nFetches the data for a given key.\n\n**Request**:\n```js\n{"get": {"key": "<string|binary>"}}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("p",null,"Key was found, the format of decoded depends on the codec (does NOT have to be a string):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "ok": {\n    "key": "<binary>",\n    "value": "<decoded>"\n  }\n}\n')),(0,i.kt)("p",null,"Key was not found:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "ok": {\n    "key": "<binary>",\n    "value": null\n  }\n}\n')),(0,i.kt)("h4",{id:"put"},"put"),(0,i.kt)("p",null,"Writes a value to a key, returns the old value if there was any."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "put": {\n    "key": "<string|binary>",\n    "value": "<to encode>" // the format of value depends on the codec (does NOT have to be a string)\n  }\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("p",null,"Key was used before, this is the old value, the format of decoded depends on the codec (does NOT have to be a string):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "ok": {\n    "key": "<binary>",\n    "value": "<decoded>"\n  }\n}\n')),(0,i.kt)("p",null,"Key was not used before:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "ok": {\n    "key": "<binary>",\n    "value": null\n  }\n}\n')),(0,i.kt)("h4",{id:"delete"},"delete"),(0,i.kt)("p",null,"Deletes a key, returns the old value if there was any."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{"delete": {"key": "<string|binary>"}}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("p",null,"Key was used before, this is the old value, the format of decoded depends on the codec (does NOT have to be a string):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "ok": {\n    "key": "<binary>",\n    "value": "<decoded>"\n  }\n}\n')),(0,i.kt)("p",null,"Key was not used before:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "ok": {\n    "key": "<binary>",\n    "value": null\n  }\n}\n')),(0,i.kt)("h4",{id:"scan"},"scan"),(0,i.kt)("p",null,"Reads a range of keys"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{"scan": {\n   "start": "<string|binary>", // optional, if not set will start with the first key\n   "end": "<string|binary>", // optional, if not set will read to the end key\n}}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "ok": [\n    {\n      "key": "<binary>", // keys are ALWAYS encoded as binary since we don\'t know if it\'s a string or binary\n      "value": "<decoded>" // the value, the format of decoded depends on the codec (does NOT have to be a string)\n    } // repeated, may be empty\n  ]\n}\n')),(0,i.kt)("h4",{id:"cas"},"cas"),(0,i.kt)("p",null,"Compare And Swap operation. Those operations require old values to match what it is compared to"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Request"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{"cas": {\n   "key": "<string|binary>", // The key to operate on\n   "old": "<to encode|not-set>", // The old value, if not set means "this value wasn\'t present"\n   "new": "<to encode|not-set>", // The new value, if not set it means it gets deleted\n}}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Response"),":\nOn success:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "ok": null,\n  "key": "<binary>"\n}\n')),(0,i.kt)("p",null,"On failure:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "error": {\n    "current": "<decoded>", // the value that is currently stored, the format of decoded depends on the codec (does NOT have to be a string)\n    "proposed": "<decoded>" // the value that was proposed/expected to be there, the format of decoded depends on the codec (does NOT have to be a string)\n  },\n  "key": "<binary>"\n}\n')),(0,i.kt)("h3",{id:"nats"},"nats"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"nats")," offramp connects to Nats server(s) and publishes a message to specified subject for every event."),(0,i.kt)("p",null,"The default ",(0,i.kt)("a",{parentName:"p",href:"codecs.md#json"},"codec")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"json"),"."),(0,i.kt)("p",null,"Supported configuration operations are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"hosts")," - List of hosts to connect to.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"subject")," - Subject for the message to be published.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"reply")," - Optional string specifying the reply subject.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"headers")," - Option key-value pairs, specifying message headers, where the key is a string and the value is a list of strings.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"options")," - Optional struct, which can be used to customize the connection to the server (see ",(0,i.kt)("a",{parentName:"p",href:"https://docs.rs/nats/0.9.8/nats/struct.Options.html"},(0,i.kt)("inlineCode",{parentName:"a"},"nats.rs")," configuration options")," for more info):"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"token"),": String; authenticate using a token."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"username"),": String; authenticate using a username and password."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"password"),": String; authenticate using a username and password."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"credentials_path"),": String; path to a ",(0,i.kt)("inlineCode",{parentName:"li"},".creds")," file for authentication."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"cert_path"),": String; path to the client certificate file."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"key_path"),": String; path to private key file."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"name"),": String; name this configuration."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"echo"),": Boolean; if true, published messages will not be delivered."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"max_reconnects"),": Integer; max number of reconnection attempts."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"reconnect_buffer_size"),": Integer; max amount of bytes to buffer when accepting outgoing traffic in disconnected mode."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"tls"),": Boolean; if true, sets tls for ",(0,i.kt)("em",{parentName:"li"},"all")," server connections."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"root_cert"),": String; path to a root certificate.")))),(0,i.kt)("p",null,"Used metadata variables are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"$nats"),": Record consisting of the following metadata:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$reply"),": Overrides ",(0,i.kt)("inlineCode",{parentName:"li"},"config.reply")," if present."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$headers"),": Overrides ",(0,i.kt)("inlineCode",{parentName:"li"},"config.headers")," if present.")))),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: nats-out\n    type: nats\n    config:\n      hosts:\n        - "127.0.0.1:4444"\n      subject: demo\n      reply: ghost\n      headers:\n        snot:\n          - badger\n          - ferris\n      options:\n        name: nats-demo\n        reconnect_buffer_size: 1\n')),(0,i.kt)("h3",{id:"newrelic"},"newrelic"),(0,i.kt)("p",null,"Send events to ",(0,i.kt)("a",{parentName:"p",href:"https://newrelic.com/"},"New Relic")," platform, using its log apis (variable by region)."),(0,i.kt)("p",null,"This offramp encodes events as json, as this is required by the ",(0,i.kt)("inlineCode",{parentName:"p"},"newrelic")," log api. Postprocessors are not used."),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"license_key")," - New Relic's license (or insert only) key"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"compress_logs")," - Whether logs should be compressed before sending to New Relic  (avoids extra egress costs but at the cost of more cpu usage by tremor) (default: false)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"region")," - Region to use to send logs. Available choices: USA, Europe (default: USA)")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"offramp:\n  - id: newrelic\n    type: newrelic\n    config:\n      license_key: keystring\n      compress_logs: true\n      region: europe\n")),(0,i.kt)("h3",{id:"otel"},"otel"),(0,i.kt)("p",null,"CNCF OpenTelemetry offramp. Publishes to the specified host or IP and destination TCP port via gRPC messages\nconforming to the CNCF OpenTelemetry protocol specification v1. Forwards tremor value variants of ",(0,i.kt)("inlineCode",{parentName:"p"},"logs"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"trace"),"\nand ",(0,i.kt)("inlineCode",{parentName:"p"},"metrics")," messages from tremor query pipelines downstream to remote OpenTelemetry endpoints."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The offramp is experimental."))),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"host")," - String - The host or IP to listen on"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"port")," - integer - The TCP port to listen on"),(0,i.kt)("li",{parentName:"ul"},"'logs' - boolean - Is logging enabled for this instance. Defaults to ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),". Received ",(0,i.kt)("inlineCode",{parentName:"li"},"logs")," events are dropped when ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,i.kt)("li",{parentName:"ul"},"'metrics' - boolean - Is metrics enabled for this instance. Defaults  to ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),". Defaults to ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),". Received ",(0,i.kt)("inlineCode",{parentName:"li"},"metrics")," events are dropped when ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,i.kt)("li",{parentName:"ul"},"'trace' - boolean - Is trace enabled for this instance. Defaults to ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),". Defaults to ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),". Received ",(0,i.kt)("inlineCode",{parentName:"li"},"trace")," events are dopped when ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),".")),(0,i.kt)("p",null,"Pipelines that leverage the OpenTelemetry integration can use utility modules in the ",(0,i.kt)("inlineCode",{parentName:"p"},"cncf::otel")," module to\nsimplify working with the tremor value mapping of the event data. The connector translates the tremor value level\ndata to protocol buffers automatically for distribution to downstream OpenTelemetry systems."),(0,i.kt)("p",null,"The connector can be used with the ",(0,i.kt)("inlineCode",{parentName:"p"},"qos::wal")," operator for transient in-memory or persistent disk-based guaranteed delivery. If either\ntremor or the downstream system fails or becomes uncontactable users can configure ( bytes and/or number of messages retained ) retention\nfor lossless recovery. For events marked as transactional that are explicitly acknowledged, ",(0,i.kt)("inlineCode",{parentName:"p"},"fail")," insights are propagated for events that\nare not succesfully transmitted downstream. Non-transactional events ( those not marked as transactional ) are delivered on a best effort\nbasis. Regardless of the transaction configuration, when paired with qos operators upstream pipelines, the sink will coordinate failover\nand recovery to the configured retention, replaying the retained messages upon recovery of network accessibility of the downstream endpoints."),(0,i.kt)("p",null,"For best effort delivery - the ",(0,i.kt)("inlineCode",{parentName:"p"},"qos::wal")," can be omitted and events distributed when downstream endpoints are inaccessible will be\nlost."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"offramp:\n  - id: otlp\n    type: otel\n    codec: json\n    config:\n      port: 4317\n      host: 10.0.2.1\n")),(0,i.kt)("h3",{id:"postgresql"},"PostgreSQL"),(0,i.kt)("p",null,"PostgreSQL offramp."),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"host")," - PostgreSQL database hostname"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"port")," - PostgresSQL database port"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"user")," - Username for authentication"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"password")," - Password for authentication"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"dbname")," - Database name"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"table")," - Database table name")),(0,i.kt)("p",null,"Data that comes in will be used to run an ",(0,i.kt)("inlineCode",{parentName:"p"},"INSERT")," statement. It is required\nthat data comes in objects representing columns. The object key must represent field\nname in the database and must contain following fields:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"fieldType")," - a PostgreSQL field type (e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"VARCHAR"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"INT4"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"TIMESTAMPTZ"),",\netc.)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"name")," - field name as represented by database table schema"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"value")," - the value of the field")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"codec")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"postprocessors")," config values are ignored as they cannot apply to this offramp, since the event is transformed into a SQL query."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yml"},"id: db\ntype: postgres\nconfig:\n  host: localhost\n  port: 5432\n  user: postgres\n  password: example\n  dbname: sales\n  table: transactions\n")),(0,i.kt)("h3",{id:"rest"},"rest"),(0,i.kt)("p",null,"The rest offramp is used to send events to the specified endpoint."),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"endpoint")," - Endpoint URL. Can be provided as string or as struct. The struct form is composed of the following standard URL fields:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"scheme")," - String, required, typically ",(0,i.kt)("inlineCode",{parentName:"li"},"http")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"username")," - String, optional"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"password")," - String, optional"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"host")," - String, required, hostname or ip address"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"port")," - Number, optional, defaults to ",(0,i.kt)("inlineCode",{parentName:"li"},"80")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"path")," - String, optional, defaults to ",(0,i.kt)("inlineCode",{parentName:"li"},"/")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"query")," - String, optional"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"fragment")," - String, optional"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"method")," - HTTP method to use (default: ",(0,i.kt)("inlineCode",{parentName:"li"},"POST"),")"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"headers")," - A map of headers to set for the requests, where both sides are strings"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"concurrency")," - Number of parallel in-flight requests (default: ",(0,i.kt)("inlineCode",{parentName:"li"},"4"),")")),(0,i.kt)("p",null,"Used metadata variables:"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Setting these metadata variables here allows users to dynamically change the behaviour of the rest offramp:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$endpoint")," - same format as config ",(0,i.kt)("inlineCode",{parentName:"li"},"endpoint")," (optional. overrides related config param when present)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$request")," - A record capturing the HTTP request attributes. Available fields within:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"method")," - same as config ",(0,i.kt)("inlineCode",{parentName:"li"},"method")," (optional. overrides related config param when present)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"headers")," - A map from header name (string) to header value (string or array of strings)(optional. overrides related config param when present)")))),(0,i.kt)("p",null,"These variables are aligned with the similar variables generated by the ",(0,i.kt)("a",{parentName:"p",href:"./onramps.md#rest"},"rest onramp"),". Note that ",(0,i.kt)("inlineCode",{parentName:"p"},"$request.url")," is not utilized here -- instead the same can be configured by setting ",(0,i.kt)("inlineCode",{parentName:"p"},"$endpoint")," (since enabling the former here can lead to request loops when events sourced from rest onramp are fed to the rest offramp, without overriding it from the pipeline. also, ",(0,i.kt)("inlineCode",{parentName:"p"},"$endpoint")," can be separately configured as a URL string, which is convenient for offramp use)."),(0,i.kt)("p",null,"The rest offramp encodes the event as request body using the ",(0,i.kt)("inlineCode",{parentName:"p"},"Content-Type")," header if present, using the customizable builtin ",(0,i.kt)("inlineCode",{parentName:"p"},"codec_map")," to determine a matching coded. It falls back to use the configured codec if no ",(0,i.kt)("inlineCode",{parentName:"p"},"Content-Type")," header is available."),(0,i.kt)("p",null,"When used as ",(0,i.kt)("a",{parentName:"p",href:"../operations/linked-transports.md"},"Linked Transport")," the same handling is applied to the incoming HTTP response, giving precedence to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Content-Type")," header and only falling back to the configured ",(0,i.kt)("inlineCode",{parentName:"p"},"codec"),"."),(0,i.kt)("p",null,"If the number of parallel requests surpass ",(0,i.kt)("inlineCode",{parentName:"p"},"concurrency"),", an error event will be emitted to the ",(0,i.kt)("inlineCode",{parentName:"p"},"err")," port, which can be used for appropriate error handling."),(0,i.kt)("p",null,"Set metadata variables:"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"These metadata variables are used for HTTP response events emitted through the ",(0,i.kt)("inlineCode",{parentName:"p"},"OUT")," port:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$response")," - A record capturing the HTTP response attributes. Available fields within:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"status")," - Numeric HTTP status code"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"headers")," - A record that maps header name (lowercase string) to value (array of strings)"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$request")," - A record with the related HTTP request attributes. Available fields within:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"method")," - HTTP method used"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"headers")," - A record containing all the request headers"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"endpoint")," - A record containing all the fields that config ",(0,i.kt)("inlineCode",{parentName:"li"},"endpoint")," does")))),(0,i.kt)("p",null,"When used as a linked offramp, batched events are rejected by the offramp."),(0,i.kt)("p",null,"Example 1:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: rest-offramp\n    type: rest\n    codec: json\n    postprocessors:\n      - gzip\n    linked: true\n    config:\n      endpoint:\n        host: httpbin.org\n        port: 80\n        path: /anything\n        query: "q=search"\n      headers:\n        "Accept": "application/json"\n        "Transfer-Encoding": "gzip"\n')),(0,i.kt)("p",null,"Example 2:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: rest-offramp-2\n    type: rest\n    codec: json\n    codec_map:\n      "text/html": "string"\n      "application/vnd.stuff": "string"\n    config:\n      endpoint:\n        host: httpbin.org\n        path: /patch\n      method: PATCH\n')),(0,i.kt)("h4",{id:"rest-offramp-example-for-influxdb"},"rest offramp example for InfluxDB"),(0,i.kt)("p",null,"The structure is given for context."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: influxdb\n    type: rest\n    codec: influx\n    postprocessors:\n      - lines\n    config:\n      endpoint:\n        host: influx\n        path: /write\n        query: db=metrics\n      headers:\n        "Client": "Tremor"\n')),(0,i.kt)("h3",{id:"stderr"},"stderr"),(0,i.kt)("p",null,"A custom stderr offramp can be configured by using this offramp type. But beware that this will share the single stderr stream with ",(0,i.kt)("inlineCode",{parentName:"p"},"system::stderr"),"."),(0,i.kt)("p",null,"The default codec is ",(0,i.kt)("a",{parentName:"p",href:"codecs.md#json"},"json"),"."),(0,i.kt)("p",null,"The stderr offramp will write a ",(0,i.kt)("inlineCode",{parentName:"p"},"\\n")," right after each event, and optionally prefix every event with a configurable ",(0,i.kt)("inlineCode",{parentName:"p"},"prefix"),"."),(0,i.kt)("p",null,"If the event data (after codec and postprocessing) is not a valid UTF8 string (e.g. if it is binary data) if will by default output the bytes with debug formatting.\nIf ",(0,i.kt)("inlineCode",{parentName:"p"},"raw")," is set to true, the event data will be put on stderr as is."),(0,i.kt)("p",null,"Supported configuration options:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"prefix")," - A prefix written before each event (optional string)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"raw")," - Write event data bytes as is to stderr.")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"offramp:\n  - id: raw_stuff\n    type: stderr\n    codec: json\n    postprocessors:\n      - snappy\n    config:\n      raw: true\n")),(0,i.kt)("h3",{id:"stdout"},"stdout"),(0,i.kt)("p",null,"A custom stdout offramp can be configured by using this offramp type. But beware that this will share the single stdout stream with ",(0,i.kt)("inlineCode",{parentName:"p"},"system::stdout"),"."),(0,i.kt)("p",null,"The default codec is ",(0,i.kt)("a",{parentName:"p",href:"codecs.md#json"},"json"),"."),(0,i.kt)("p",null,"The stdout offramp will write a ",(0,i.kt)("inlineCode",{parentName:"p"},"\\n")," right after each event, and optionally prefix every event with a configurable ",(0,i.kt)("inlineCode",{parentName:"p"},"prefix"),"."),(0,i.kt)("p",null,"If the event data (after codec and postprocessing) is not a valid UTF8 string (e.g. if it is binary data) if will by default output the bytes with debug formatting.\nIf ",(0,i.kt)("inlineCode",{parentName:"p"},"raw")," is set to true, the event data will be put on stdout as is."),(0,i.kt)("p",null,"Supported configuration options:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"prefix")," - A prefix written before each event (optional string)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"raw")," - Write event data bytes as is to stdout.")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: like_a_python_repl\n    type: stdout\n    config:\n      prefix: ">>> "\n')),(0,i.kt)("h3",{id:"tcp"},"tcp"),(0,i.kt)("p",null,"This connects on a specified port for distributing outbound TCP data. TLS is supported via ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ctz/rustls"},"rustls"),"."),(0,i.kt)("p",null,"The offramp can leverage postprocessors to frame data after codecs are applied and events are forwarded\nto external TCP protocol distribution endpoints."),(0,i.kt)("p",null,"The default ",(0,i.kt)("a",{parentName:"p",href:"codecs.md#json"},"codec")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"json"),"."),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"host")," - The host to advertise as"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"port")," - The TCP port to listen on"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"is_non_blocking")," - Is the socket configured as non-blocking ( default: false )"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ttl")," - Set the socket's time-to-live ( default: 64 )"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"is_no_delay")," - Set the socket's Nagle ( delay ) algorithm to off ( default: true )"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"tls")," - If set to ",(0,i.kt)("inlineCode",{parentName:"li"},"true")," or a detailed TLS config with the keys below, will wrap the TCP socket with a TLS session. ( default: ",(0,i.kt)("inlineCode",{parentName:"li"},"false")," )",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"cafile")," - If provided, only server certificates signed by the Certificate Authority represented by the root certificate in ",(0,i.kt)("inlineCode",{parentName:"li"},"cafile")," are accepted. If not provided, all root certificated distributed by Mozilla via ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/rustls/webpki-roots"},"webpki-roots")," are loaded."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"domain")," - if provided, this will be the domain to verify the TLS certificate against. It might differ to ",(0,i.kt)("inlineCode",{parentName:"li"},"host"),", especially if ",(0,i.kt)("inlineCode",{parentName:"li"},"host")," is given as IP address. If not provided, the ",(0,i.kt)("inlineCode",{parentName:"li"},"host")," config is used as domain.")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: tcp\n    type: tcp\n    codec: json\n    postprocessors:\n      - gzip\n      - base64\n      - lines\n    config:\n      host: "localhost"\n      port: 9000\n')),(0,i.kt)("h4",{id:"tls-support"},"TLS Support"),(0,i.kt)("p",null,"TLS support is enabled by providing either ",(0,i.kt)("inlineCode",{parentName:"p"},"tls: true")," or a detailed config."),(0,i.kt)("p",null,"When providing ",(0,i.kt)("inlineCode",{parentName:"p"},"tls: true"),", the TCP offramp is verifying the server it connects to and its certificate against the ",(0,i.kt)("inlineCode",{parentName:"p"},"host")," config, and a set of common root-certificates provided by Mozilla via ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/rustls/webpki-roots"},"webpki-roots"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: tcp\n    type: tcp\n    codec: json\n    postprocessors:\n      - length-prefixed\n    config:\n      host: "example.com"\n      port: 443\n      tls: true\n')),(0,i.kt)("p",null,"This behaviour can be tuned by providing a detailed config. If ",(0,i.kt)("inlineCode",{parentName:"p"},"tls.cafile")," is provided, the TCP offramp will only accept server certificates signed (directly or indirectly via a server-provided certificate chain) by the given root-certificate. This is useful for testing against self-signed certificates. In this case the self signed certificate needs to provided via ",(0,i.kt)("inlineCode",{parentName:"p"},"tls.cafile"),". If ",(0,i.kt)("inlineCode",{parentName:"p"},"tls.domain")," is provided, this value will be used instead of the ",(0,i.kt)("inlineCode",{parentName:"p"},"host")," config to verify the domain name provided in the server certificate. This is especially useful if an IP address is used as ",(0,i.kt)("inlineCode",{parentName:"p"},"host")," config."),(0,i.kt)("p",null,"Client certificates are not supported."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: tls\n    type: tcp\n    codec: json\n    config:\n      host: "127.0.0.1"\n      port: 65535\n      tls:\n        cafile: "path/to/custom_ca.pem"\n        domain: "localhost"\n')),(0,i.kt)("p",null,"For testing purposes, self-signed certificates need the Subject Alternative Name extension, otherwise setting up the onramp will fail with a ",(0,i.kt)("inlineCode",{parentName:"p"},"BadDER")," Error. Adding this when generating a self-signed certificate can be done by passing ",(0,i.kt)("inlineCode",{parentName:"p"},"-addext 'subjectAltName = DNS:<DOMAIN>'")," via ",(0,i.kt)("inlineCode",{parentName:"p"},"openssl")," command line or by adding it to ",(0,i.kt)("inlineCode",{parentName:"p"},"openssl.cfg")," as described in the ",(0,i.kt)("a",{parentName:"p",href:"https://www.openssl.org/docs/man1.1.1/man5/x509v3_config.html#Subject-Alternative-Name"},"openssl manual"),"."),(0,i.kt)("h3",{id:"udp"},"udp"),(0,i.kt)("p",null,"The UDP offramp sends data to a given host and port as UDP datagram."),(0,i.kt)("p",null,"The default ",(0,i.kt)("a",{parentName:"p",href:"codecs.md#json"},"codec")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"json"),"."),(0,i.kt)("p",null,"When the UDP onramp gets a batch of messages it will send each element of the batch as a distinct UDP datagram."),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"bind.host")," - the local host to send data from"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"bind.port")," - the local port to send data from"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"host")," - the destination host to send data to"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"port")," - the destination port to send data to.")),(0,i.kt)("p",null,":::warn\nSetting ",(0,i.kt)("inlineCode",{parentName:"p"},"bound")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"false")," makes the UDP offramp potentially extremely slow as it forces a lookup of the destination on each event!\n:::"),(0,i.kt)("p",null,"Used metadata variables:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$udp.host"),": This overwrites the configured destination host for this event. Expects a string."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$udp.port"),": This overwrites the configured destination port for this event. Expects an integer.")),(0,i.kt)("p",null,":::warn\nBe careful to set ",(0,i.kt)("inlineCode",{parentName:"p"},"$udp.host")," to an IP, ",(0,i.kt)("strong",{parentName:"p"},"not")," a DNS name or the OS will resolve it on every event, which will be extremely slow!\n:::"),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'offramp:\n  - id: udp-out\n    type: udp\n    postprocessors:\n      - base64\n    config:\n      bind:\n        host: "10.11.12.13"\n        port: 1234\n      host: "20.21.22.23"\n      port: 2345\n')),(0,i.kt)("h3",{id:"ws"},"ws"),(0,i.kt)("p",null,"Sends events over a WebSocket connection. Each event is a WebSocket message."),(0,i.kt)("p",null,"The default ",(0,i.kt)("a",{parentName:"p",href:"codecs.md#json"},"codec")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"json"),"."),(0,i.kt)("p",null,"Supported configuration options are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"url")," - WebSocket endpoint to send data to."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"binary")," - If data should be send as binary instead of text (default: ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),").")),(0,i.kt)("p",null,"Used metadata variables:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$url")," - same as config ",(0,i.kt)("inlineCode",{parentName:"li"},"url")," (optional. overrides related config param when present)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$binary")," - same as config ",(0,i.kt)("inlineCode",{parentName:"li"},"binary")," (optional. overrides related config param when present)")),(0,i.kt)("p",null,"Set metadata variables (for reply with ",(0,i.kt)("a",{parentName:"p",href:"../operations/linked-transports.md"},"linked transports"),"):"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$binary")," - ",(0,i.kt)("inlineCode",{parentName:"li"},"true")," if the WebSocket message reply came as binary (",(0,i.kt)("inlineCode",{parentName:"li"},"false")," otherwise)")),(0,i.kt)("p",null,"When used as a linked offramp, batched events are rejected by the offramp."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'onramp:\n  - id: ws\n    type: ws\n    config:\n      url: "ws://localhost:1234"\n')))}m.isMDXComponent=!0}}]);