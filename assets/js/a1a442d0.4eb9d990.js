(self.webpackChunknew_tremor_website=self.webpackChunknew_tremor_website||[]).push([[2108],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return d},kt:function(){return m}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=r.createContext({}),l=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=l(e.components);return r.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,p=e.parentName,d=a(e,["components","mdxType","originalType","parentName"]),u=l(n),m=o,h=u["".concat(p,".").concat(m)]||u[m]||c[m]||s;return n?r.createElement(h,i(i({ref:t},d),{},{components:n})):r.createElement(h,i({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,i=new Array(s);i[0]=u;var a={};for(var p in t)hasOwnProperty.call(t,p)&&(a[p]=t[p]);a.originalType=e,a.mdxType="string"==typeof e?e:o,i[1]=a;for(var l=2;l<s;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4008:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return a},contentTitle:function(){return p},metadata:function(){return l},toc:function(){return d},default:function(){return u}});var r=n(2122),o=n(9756),s=(n(7294),n(3905)),i=["components"],a={},p="syslog udp dns",l={unversionedId:"Workshop/examples/syslog_udp_dns/README",id:"Workshop/examples/syslog_udp_dns/README",isDocsHomePage:!1,title:"syslog udp dns",description:"This workshop is the samne as the syslogupd workship with the added component of enriching the syslog message we receive with a DNS lookup.",source:"@site/docs/Workshop/examples/15_syslog_udp_dns/README.md",sourceDirName:"Workshop/examples/15_syslog_udp_dns",slug:"/Workshop/examples/syslog_udp_dns/README",permalink:"/tremor-new-website/docs/Workshop/examples/syslog_udp_dns/README",editUrl:"https://github.com/tremor-rs/tremor-new-website/tree/main/docs/docs/Workshop/examples/15_syslog_udp_dns/README.md",version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"syslog udp",permalink:"/tremor-new-website/docs/Workshop/examples/syslog_udp/README"},next:{title:"Transient Write-Ahead Log",permalink:"/tremor-new-website/docs/Workshop/examples/transient_gd/README"}},d=[{value:"Setup",id:"setup",children:[]},{value:"Environment",id:"environment",children:[]},{value:"Business Logic",id:"business-logic",children:[]}],c={toc:d};function u(e){var t=e.components,a=(0,o.Z)(e,i);return(0,s.kt)("wrapper",(0,r.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"syslog-udp-dns"},"syslog udp dns"),(0,s.kt)("p",null,"This workshop is the samne as the ",(0,s.kt)("a",{parentName:"p",href:"../14_syslog_udp/"},"syslog_upd")," workship with the added component of enriching the syslog message we receive with a DNS lookup."),(0,s.kt)("p",null,"We will only discuss the newly introduced components, for the rest pleas refer to the ",(0,s.kt)("a",{parentName:"p",href:"../14_syslog_udp/"},"syslog_upd")," workshop."),(0,s.kt)("h2",{id:"setup"},"Setup"),(0,s.kt)("p",null,"!!! tip\nAll the code here is available in the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/tremor-rs/tremor-www-docs/tree/main/docs/workshop/examples/14_syslog_udp"},"git repository")," as well and can be run with ",(0,s.kt)("inlineCode",{parentName:"p"},"docker compose up"),"."),(0,s.kt)("h2",{id:"environment"},"Environment"),(0,s.kt)("p",null,"We get a new ",(0,s.kt)("a",{target:"_blank",href:n(7115).Z},"sink"),", the ",(0,s.kt)("inlineCode",{parentName:"p"},"dns")," sink. This is what tremor calls a ",(0,s.kt)("inlineCode",{parentName:"p"},"linked transport"),", aka a ",(0,s.kt)("inlineCode",{parentName:"p"},"sink")," or ",(0,s.kt)("inlineCode",{parentName:"p"},"source")," that can both receive and send messages."),(0,s.kt)("p",null,"In the case of the ",(0,s.kt)("inlineCode",{parentName:"p"},"dns")," sink it receives lookup requests and sends the replies."),(0,s.kt)("p",null,"This changes the ",(0,s.kt)("a",{target:"_blank",href:n(7862).Z},"binding")," the following way:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"metronome -> producer -> syslog-udp-out\n\nsyslog-udp-in -> dns -> dns\n\ndns -> consumer -> stdout-output\n")),(0,s.kt)("h2",{id:"business-logic"},"Business Logic"),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"producer")," pipeline remains unchanged however we add a new ",(0,s.kt)("inlineCode",{parentName:"p"},"dns")," pipeline and the ",(0,s.kt)("inlineCode",{parentName:"p"},"consumer")," piepline now includes some logic."),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"dns")," pipeline does two things. First it moves the event itself into the ",(0,s.kt)("inlineCode",{parentName:"p"},"$correlation")," metadata. Linked transports will preserve this metadata key over requests allowing to correlate the output event with the input request. Second it changes the event into a lookup of the ",(0,s.kt)("inlineCode",{parentName:"p"},"A")," record (ip address) for the hostname. Finally we do the wiering with select statments."),(0,s.kt)("p",null,"!!! warn\nStoring data in ",(0,s.kt)("inlineCode",{parentName:"p"},"$correlation")," will mean this data has to be kept in memory until the event is processed, depending on throughput and pending requests this can be a significant memory cost."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-trickle"},'# dns.trickle\ndefine script dns\nscript\n let $correlation = event;\n {\n  "lookup": $correlation.hostname,\n  "type": "A"\n }\nend;\n\ncreate script dns;\n\nselect event from in into dns;\nselect event from dns into out;\n')),(0,s.kt)("p",null,"In addition the ",(0,s.kt)("inlineCode",{parentName:"p"},"consumer")," pipeline got slightly more complicated. We use ",(0,s.kt)("inlineCode",{parentName:"p"},"merge")," to replace the lookup response from the ",(0,s.kt)("inlineCode",{parentName:"p"},"dns")," sink with it's correlation (the orriginal event) and merge merge it by inserting the IP we looked up into the event. In result we now have the original event with the added ",(0,s.kt)("inlineCode",{parentName:"p"},"ip")," field containing the IP correlating to the hostname."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-trickle"},'# consumer.trickle\nselect merge $correlation of {"ip": event[0].A} end from in into out\n')))}u.isMDXComponent=!0},7115:function(e,t,n){"use strict";t.Z=n.p+"assets/files/00_ramps-3aff56264bc3e23d9b0ea73cc601f6a0.yaml"},7862:function(e,t,n){"use strict";t.Z=n.p+"assets/files/01_binding-80164180a5c99e2f5bd7a319de9dbad2.yaml"}}]);