<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tremor Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tremor Blog Atom Feed"><title data-react-helmet="true">binary-type | Tremor</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://www.tremor.rs//rfc/accepted/binary-type"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-react-helmet="true" property="og:title" content="binary-type | Tremor"><meta data-react-helmet="true" name="description" content="- Feature Name: binary-type"><meta data-react-helmet="true" property="og:description" content="- Feature Name: binary-type"><link data-react-helmet="true" rel="shortcut icon" href="/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.tremor.rs//rfc/accepted/binary-type"><link data-react-helmet="true" rel="alternate" href="https://www.tremor.rs//rfc/accepted/binary-type" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.tremor.rs//rfc/accepted/binary-type" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.b987a0a0.css">
<link rel="preload" href="/assets/js/runtime~main.91f82e5b.js" as="script">
<link rel="preload" href="/assets/js/main.98e9b71b.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.tremor.rs/" target="_self" rel="noopener noreferrer" class="navbar__brand"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/next/getting-started/getting-started">Getting Started</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/community/community">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/community">Overview</a></li><li><a href="https://chat.tremor.rs" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Chat<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a class="dropdown__link" href="/community/governance">Governance</a></li><li><a class="dropdown__link" href="/community/faqs">FAQs</a></li><li><a class="dropdown__link" href="/rfc/index">RFCs</a></li><li><a class="dropdown__link" href="/community/EventsAndMedia">Events and Media</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/index">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/docs/index">0.11</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/getting-started/getting-started">Next</a></li><li><a class="dropdown__link" href="/docs/index">0.11</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://chat.tremor.rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discord-link" aria-label="Community Chat"></a><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rfc/index">RFCs</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Accepted</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rfc/accepted/binary-type">binary-type</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/accepted/script-operator-enhacements">script-operator-enhacements</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/accepted/pipeline-state-mechanism">Pipeline State Mechanism</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/accepted/sliding-window-mechanism">Sliding Window Mechanism</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/accepted/plugin-development-kit">Plugin development Kit</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/accepted/ramp-interface">Ramp Interface</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Implemented</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">RFC Process</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>binary-type</h1></header><ul><li>Feature Name: binary-type</li><li>Start Date: 2020-12-16</li><li>Tremor Issue: <a href="https://github.com/tremor-rs/tremor-runtime/issues/0000" target="_blank" rel="noopener noreferrer">tremor-rs/tremor-runtime#0000</a></li><li>RFC PR: <a href="https://github.com/tremor-rs/tremor-rfcs/pull/0000" target="_blank" rel="noopener noreferrer">tremor-rs/tremor-rfcs#0000</a></li></ul><header><h1>Summary</h1></header><p>This RFC proposes the addition of a new type: <code>binary</code> along with the underpinnings needed to extend tremors type system.</p><header><h1>Motivation</h1></header><p>The motivation here is three-fold.</p><p>As of writing this RFC tremor has no option to handle &#x27;raw&#x27; data. As it stands, even if we never want to inspect or modify a payload we always pay the price of translating the data into tremors internal, JSONesque format or representing it as a utf8 string. Both these choices come at a computation cost at best or are wrong and lossy at worst. A binary type allows us to treat a message as &quot;a bunch of bytes&quot;, removing any loss or additional computational cost of encoding/decoding them.</p><p>The second reason for a binary datatype is to be able to handle messages that are not covered by existing codes. A binary type along with the functions to inspect, deconstruct or create binary messages gives a new extension point for users to parse their own, non-textual formats.</p><p>Last but not least, extending tremor with a binary type, something that JSON isn&#x27;t capable of representing lays the groundwork for adding more powerful types to tremor. It serves as a case study of the cost/complexity of this and will help simplifying the task for later additions.</p><header><h1>Guide-level explanation</h1></header><p>The <code>binary</code> type in tremor comes along with additions to the tremor-script syntax, the type system, codecs, the standard library and a specification of the serialization behavior. We will discuss each of those </p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="the-binary-type"></a>The <code>binary</code> type<a class="hash-link" href="#the-binary-type" title="Direct link to heading">#</a></h2><p>The easiest way to think about it is that the <code>binary</code> type represents an array of bytes.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="serialization"></a>Serialization<a class="hash-link" href="#serialization" title="Direct link to heading">#</a></h2><p>Serialization is codec dependant and not always symmetric. A codec that can not represent binary data and is a general-purpose codec it will default to base64 encoding the data as a string (JSON for example). This is an asymmetric change as we will not by default decode a base64 string as binary given without context we can&#x27;t determine if this is the desired behavior or not, this can however be done using tremor-scripts functions.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="syntax"></a>Syntax<a class="hash-link" href="#syntax" title="Direct link to heading">#</a></h2><p>We use the <a href="https://erlang.org/doc/programming_examples/bit_syntax.html" target="_blank" rel="noopener noreferrer">erlang bit syntax</a> as an inspiration. Tremor script gains support for binary semi-literals using the form of <code>&lt;&lt; expr1:&lt;size&gt;/&lt;type&gt;, expr2 &gt;&gt;</code> where:</p><ul><li><code>expr</code> cab be either a number, another binary or a string.</li><li><code>size</code> defines the size in bits for numbers ranging for 1 to 64, sub bit sizes are supported, or the size in bytes for strings and binaries. The default size for integers is <code>8</code> and for strings or binaries is the entire binary</li><li><code>type</code> needs to be specified as <code>binary</code> for strings and binaries or can be a combination of endianness (<code>big</code>, <code>little</code>), signedness (<code>unsigned</code>, <code>signed</code>) and numeric type (<code>integer</code>) where parts are concatinated by a <code>-</code> and the first one enumerated is the default</li></ul><p>The default (no size or type suffix) being equivalent to <code>:8/big-unsigned-integer</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="stdlib"></a>stdlib<a class="hash-link" href="#stdlib" title="Direct link to heading">#</a></h2><p>This RFC introduces the <code>base64</code> module for encoding and decoding <code>binary</code> data as base64 strings. It also adds the <code>binary</code> module with basic functions such as <code>len</code>, as well as conversion functions to and from arrays of numbers.</p><p>The <code>string</code> module gains functions to convert a string to a <code>binary</code> as well as a function that will take a <code>binary</code> and convert it to a utf8 <code>string</code> in a potentially lossy fashion for invalid utf8 data.</p><p>The <code>type</code> module will gain the <code>is_binary</code> function as well as <code>type::as_string</code> now returning <code>&quot;binary&quot;</code> when appropriate.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="codecs"></a>codecs<a class="hash-link" href="#codecs" title="Direct link to heading">#</a></h2><p>This RFC introduces the <code>binary</code> codec that passes bytes unmodified as binary data.</p><p>The <code>json</code> codec is changed to serialize <code>binary</code> data as a base64 encoded string, however it will not automatically decode base64 strings as binary.</p><p>The <code>msgpack</code> codec should encode and decode binary as <code>bin</code> types.</p><header><h1>Reference-level explanation</h1></header><p>The <code>binary</code> type is a <code>Vec&lt;u8&gt;</code> that serializes as base64 encoded string in simd-json and as <code>bytes</code> in serde compatible encoders.</p><p>If the new implemented functions are all constant, they will be able to be pre-computed when constant folding is possible.</p><p>The binary semi-literals will, whenever possible be turned into full-literals using constant folding, but remain constructs where not following the example of arrays and records.</p><p>If a literal is created that is not byte aligned the bits that overhang the last byte boundary will be treated as part of a new
byte filling the less significant bits of it.</p><p>In other words <code>&lt;&lt;1:8, 2:4&gt;&gt;</code> where we only have 4 bytes of the second byte will fill to: <code>&lt;&lt;1:8, 2:8&gt;&gt;</code>.</p><header><h1>Drawbacks</h1></header><p>This breaks symmetry with the JSON representation, however all differences can be recovered using the provided tremor-script functionality.</p><header><h1>Rationale and alternatives</h1></header><p>There are no decent alternative binary syntax to erlangs binary forms we found as part of the research.</p><p>Many C derived languages support encoding bytes in a string like form, this however doesn&#x27;t offer anything near the capabilities we require.</p><header><h1>Prior art</h1></header><p>This RFC is heavily inspired by the (erlang bit syntax)[https://erlang.org/doc/programming_examples/bit_syntax.html].</p><header><h1>Unresolved questions</h1></header><p>As of writing the first draft of this RFC it is still open how far into bit syntax compatibility it will go while balancing benefit and time constraints. Binary comprehensions, as existing in erlang are not part of this RFC. Neither support for &#x27;less then a byte&#x27; boundaires.</p><header><h1>Future possibilities</h1></header><p>Binary comprehensions are a major future possibility for bit syntax. They are also well seperated in the way that extracting them will not harm this RFC.</p><p>Matching binaries is the next logical step. Due to it being significantly more complex and the work on binary types and semi-literals is self contained, this will be handled in a seperate RFC.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rfc/index"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« RFCs</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rfc/accepted/script-operator-enhacements"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">script-operator-enhacements Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-binary-type" class="table-of-contents__link">The <code>binary</code> type</a></li><li><a href="#serialization" class="table-of-contents__link">Serialization</a></li><li><a href="#syntax" class="table-of-contents__link">Syntax</a></li><li><a href="#stdlib" class="table-of-contents__link">stdlib</a></li><li><a href="#codecs" class="table-of-contents__link">codecs</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/quick-start/">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/community/faqs">FAQs</a></li><li class="footer__item"><a class="footer__link-item" href="/api/0">Tremor API</a></li><li class="footer__item"><a class="footer__link-item" href="/community/governance/CodeofConduct">Code of Conduct</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://chat.tremor.rs/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/TremorDEBS" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/tremor-rs/tremor-runtime/releases" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Download<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.cncf.io/" target="_blank" rel="noreferrer noopener" aria-label="CNCF"><img src="/img/cncf-color.svg" alt="CNCF" style="width: 200px;"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/favicon.ico" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/favicon.ico" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div><div class="footer__copyright">Copyright Â© 2021 Tremor</div></div></div></footer></div>
<script src="/assets/js/runtime~main.91f82e5b.js"></script>
<script src="/assets/js/main.98e9b71b.js"></script>
</body>
</html>