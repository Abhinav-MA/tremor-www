<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tremor Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tremor Blog Atom Feed"><title data-react-helmet="true">Onramp Postgres | Tremor</title><meta data-react-helmet="true" property="og:url" content="https://www.tremor.rs//rfc/implemented/onramp-postgres"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-react-helmet="true" property="og:title" content="Onramp Postgres | Tremor"><meta data-react-helmet="true" name="description" content="- Feature Name: rfc0008onramp_postgres"><meta data-react-helmet="true" property="og:description" content="- Feature Name: rfc0008onramp_postgres"><link data-react-helmet="true" rel="shortcut icon" href="/docs/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.tremor.rs//rfc/implemented/onramp-postgres"><link data-react-helmet="true" rel="alternate" href="https://www.tremor.rs//rfc/implemented/onramp-postgres" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.tremor.rs//rfc/implemented/onramp-postgres" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.772104c2.css">
<link rel="preload" href="/assets/js/runtime~main.cdc26680.js" as="script">
<link rel="preload" href="/assets/js/main.7fda42e1.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.tremor.rs/" target="_self" rel="noopener noreferrer" class="navbar__brand"><img src="/img/tremor-logo.png" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/tremor-logo.png" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/getting-started/about/">About Us</a><a class="navbar__item navbar__link" href="/docs/index">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/quick-start">Usage Guide</a><a class="navbar__item navbar__link" href="/api/0">API</a><a class="navbar__item navbar__link" href="/rfc/index">RFCs</a><a class="navbar__item navbar__link" href="/community/community">Community</a><a class="navbar__item navbar__link" href="/community/governance">Governance</a><a class="navbar__item navbar__link" href="/faqs">FAQs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/docs/index">0.11</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/index">Next</a></li><li><a class="dropdown__link" href="/docs/index">0.11</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub">GitHub</a><div class="searchWrapper_3rmH"><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://www.tremor.rs/" target="_self" rel="noopener noreferrer" class="navbar__brand"><img src="/img/tremor-logo.png" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/tremor-logo.png" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/getting-started/about/">About Us</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/index">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/quick-start">Usage Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/api/0">API</a></li><li class="menu__list-item"><a class="menu__link" href="/rfc/index">RFCs</a></li><li class="menu__list-item"><a class="menu__link" href="/community/community">Community</a></li><li class="menu__list-item"><a class="menu__link" href="/community/governance">Governance</a></li><li class="menu__list-item"><a class="menu__link" href="/faqs">FAQs</a></li><li class="menu__list-item"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub">GitHub</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/index">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/index">0.11</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/rfc/index">Tremor RFCs</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Accepted</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/accepted/pipeline-state-mechanism">Pipeline State Mechanism</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/accepted/sliding-window-mechanism">Sliding Window Mechanism</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/accepted/plugin-development-kit">Plugin development Kit</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/accepted/ramp-interface">Ramp Interface</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Implemented</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/remove-actix-from-tremor-runtime">Remove Actix</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/linked-transports">Linked Transports</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/circuit-breaker-mechanism">Circuit Breaker Mechanism</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/pipeline-optimizations">Pipeline Optimisations</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/rfc/implemented/onramp-postgres">Onramp Postgres</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/modularity">Modularity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/string-interpolation">String Interpolation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/correlation">Correlation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">RFC Process</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/process/template">RFC Template (RFC Title goes here)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/process/api_changes">API Changes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/process/arch_changes">Architecture Changes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/process/lang_changes">Language Changes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/process/lib_changes">Library Changes</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Onramp Postgres</h1></header><div class="markdown"><ul><li>Feature Name: <code>rfc_0008_onramp_postgres</code></li><li>Start Date: 2020-01-21</li><li>Tremor Issue:
<a href="https://github.com/tremor-rs/tremor-rfcs/issues/15" target="_blank" rel="noopener noreferrer">tremor-rs/tremor-runtime#0015</a></li><li>RFC PR: <a href="https://github.com/tremor-rs/tremor-rfcs/pull/14" target="_blank" rel="noopener noreferrer">tremor-rs/tremor-rfcs#0008</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>Pull data from Postgres tables.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="motivation"></a>Motivation<a class="hash-link" href="#motivation" title="Direct link to heading">#</a></h2><p>We see use cases a function of features supported by PostgreSQL out of the box,
as well as additional features introduced as extensions or otherwise packaged as
completely separate products. Primary examples that we are looking at are <a href="https://www.timescale.com/" target="_blank" rel="noopener noreferrer">TimescaleDB</a> and <a href="https://www.pipelinedb.com/" target="_blank" rel="noopener noreferrer">PipelineDB</a>.</p><p>The ultimate goal is to be able to reliably pipe in data from PostgreSQL core to Tremor engine.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="guide-level-explanation"></a>Guide-level Explanation<a class="hash-link" href="#guide-level-explanation" title="Direct link to heading">#</a></h2><p>PostgreSQL is a standard Tremor onramp. It is configured by passing in standard PostgreSQL connection string arguments, such as <code>host</code>, <code>port</code>, <code>user</code>, <code>password</code> and <code>dbname</code>.</p><p>In addition to connection string arguments, we require:</p><ul><li><code>interval</code> in milliseconds that specifies the time we wait before executing the next query.</li><li><code>consume_from</code> specifies the timestamp from which to backfill data.</li><li><code>query</code> in form of standard <code>SELECT</code> query which retrieves rows from a table or view.</li></ul><p>Unlike other onramps implemented so far, PostgreSQL onramp will persist <code>consume_from</code> and <code>consume_until</code>, allowing recovery from error conditions or other failures.</p><p>Example <code>onramp.yml</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><div tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> db</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">codec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> json</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> localhost</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5432</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> example</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">query</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &quot;SELECT id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name from events WHERE produced_at &lt;= $1 AND produced_at </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  $2&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">interval_ms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dbname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sales</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/path/to/cache.json&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4096</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Cache is a memory mapped region, either file-based or anonymous.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reference-level-explanation"></a>Reference-level Explanation<a class="hash-link" href="#reference-level-explanation" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="drawbacks"></a>Drawbacks<a class="hash-link" href="#drawbacks" title="Direct link to heading">#</a></h2><p>The onramp does not provide an implementation of all types Postgres supports and
the entirety of query language (for example, LISTEN/NOTIFY semantics).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rationale-and-alternatives"></a>Rationale and Alternatives<a class="hash-link" href="#rationale-and-alternatives" title="Direct link to heading">#</a></h2><p>As a starting point, or first implementation, supporting basic <code>SELECT</code> statements with a time interval as additional <code>WHERE</code> clause supports the major use case: ingesting rows from a table or view.</p><p>Alternative approach would utilize PostgreSQL <a href="https://www.postgresql.org/docs/12/libpq-single-row-mode.html" target="_blank" rel="noopener noreferrer"><em>single row mode</em></a> suitable for ingestion of results returned by queries that span a large number of rows. Ensuring <em>at-most-once</em> ingestion of rows would be a potential problem and a time-consuming/API-breaking implementation.</p><p>Other approaches, such as trigger-based watches or binary log readers are also a
possibility.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="prior-art"></a>Prior Art<a class="hash-link" href="#prior-art" title="Direct link to heading">#</a></h2><p><a href="https://en.wikipedia.org/wiki/Data_integration" target="_blank" rel="noopener noreferrer">Data Integration</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="unresolved-questions"></a>Unresolved Questions<a class="hash-link" href="#unresolved-questions" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="future-possibilities"></a>Future Possibilities<a class="hash-link" href="#future-possibilities" title="Direct link to heading">#</a></h2><p>For users that utilise PostgreSQL as an event store, which seems to be a more
common use case lately, support for <a href="https://www.postgresql.org/docs/12/sql-notify.html" target="_blank" rel="noopener noreferrer"><code>LISTEN/NOTIFY</code></a> would be essential to become one of modes of this onramp.</p><p>Support multiple queries in the same onramp.</p><p>More flexible means of specifying parameters.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rfc/implemented/pipeline-optimizations"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Pipeline Optimisations</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rfc/implemented/modularity"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Modularity Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link">Summary</a></li><li><a href="#motivation" class="table-of-contents__link">Motivation</a></li><li><a href="#guide-level-explanation" class="table-of-contents__link">Guide-level Explanation</a></li><li><a href="#reference-level-explanation" class="table-of-contents__link">Reference-level Explanation</a></li><li><a href="#drawbacks" class="table-of-contents__link">Drawbacks</a></li><li><a href="#rationale-and-alternatives" class="table-of-contents__link">Rationale and Alternatives</a></li><li><a href="#prior-art" class="table-of-contents__link">Prior Art</a></li><li><a href="#unresolved-questions" class="table-of-contents__link">Unresolved Questions</a></li><li><a href="#future-possibilities" class="table-of-contents__link">Future Possibilities</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/quick-start/">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/faqs/">FAQs</a></li><li class="footer__item"><a class="footer__link-item" href="/api/0">Tremor API</a></li><li class="footer__item"><a class="footer__link-item" href="/community/governance/CodeofConduct">Code of Conduct</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://chat.tremor.rs/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/TremorDEBS" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://github.com/tremor-rs/tremor-runtime/releases" target="_blank" rel="noopener noreferrer" class="footer__link-item">Download</a></li><li class="footer__item"><a href="https://www.cncf.io/" target="_blank" rel="noreferrer noopener" aria-label="CNCF"><img src="cncf-color.svg" alt="CNCF"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/favicon.ico" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/favicon.ico" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div><div class="footer__copyright">Copyright Â© 2021 Tremor</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cdc26680.js"></script>
<script src="/assets/js/main.7fda42e1.js"></script>
</body>
</html>