<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tremor Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tremor Blog Atom Feed"><title data-react-helmet="true">Circuit Breaker Mechanism | Tremor</title><meta data-react-helmet="true" property="og:url" content="https://www.tremor.rs//rfc/implemented/circuit-breaker-mechanism"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-react-helmet="true" property="og:title" content="Circuit Breaker Mechanism | Tremor"><meta data-react-helmet="true" name="description" content="- Feature Name: rfc0005circuitbreakermechanism"><meta data-react-helmet="true" property="og:description" content="- Feature Name: rfc0005circuitbreakermechanism"><link data-react-helmet="true" rel="shortcut icon" href="/docs/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.tremor.rs//rfc/implemented/circuit-breaker-mechanism"><link data-react-helmet="true" rel="alternate" href="https://www.tremor.rs//rfc/implemented/circuit-breaker-mechanism" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.tremor.rs//rfc/implemented/circuit-breaker-mechanism" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.772104c2.css">
<link rel="preload" href="/assets/js/runtime~main.29a598d0.js" as="script">
<link rel="preload" href="/assets/js/main.a181b444.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.tremor.rs/" target="_self" rel="noopener noreferrer" class="navbar__brand"><img src="/img/tremor-logo.png" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/tremor-logo.png" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/getting-started/about/">About Us</a><a class="navbar__item navbar__link" href="/docs/index">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/quick-start">Usage Guide</a><a class="navbar__item navbar__link" href="/api/0">API</a><a class="navbar__item navbar__link" href="/rfc/index">RFCs</a><a class="navbar__item navbar__link" href="/community/community">Community</a><a class="navbar__item navbar__link" href="/community/governance">Governance</a><a class="navbar__item navbar__link" href="/faqs">FAQs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub">GitHub</a><div class="searchWrapper_3rmH"><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://www.tremor.rs/" target="_self" rel="noopener noreferrer" class="navbar__brand"><img src="/img/tremor-logo.png" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/tremor-logo.png" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/getting-started/about/">About Us</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/index">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/quick-start">Usage Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/api/0">API</a></li><li class="menu__list-item"><a class="menu__link" href="/rfc/index">RFCs</a></li><li class="menu__list-item"><a class="menu__link" href="/community/community">Community</a></li><li class="menu__list-item"><a class="menu__link" href="/community/governance">Governance</a></li><li class="menu__list-item"><a class="menu__link" href="/faqs">FAQs</a></li><li class="menu__list-item"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/rfc/index">Tremor RFCs</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Accepted</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/accepted/pipeline-state-mechanism">Pipeline State Mechanism</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/accepted/sliding-window-mechanism">Sliding Window Mechanism</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/accepted/plugin-development-kit">Plugin development Kit</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/accepted/ramp-interface">Ramp Interface</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Implemented</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/remove-actix-from-tremor-runtime">Remove Actix</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/linked-transports">Linked Transports</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/rfc/implemented/circuit-breaker-mechanism">Circuit Breaker Mechanism</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/pipeline-optimizations">Pipeline Optimisations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/onramp-postgres">Onramp Postgres</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/modularity">Modularity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/string-interpolation">String Interpolation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/rfc/implemented/correlation">Correlation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">RFC Process</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/process/template">RFC Template (RFC Title goes here)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/process/api_changes">API Changes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/process/arch_changes">Architecture Changes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/process/lang_changes">Language Changes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/rfc/process/lib_changes">Library Changes</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Circuit Breaker Mechanism</h1></header><div class="markdown"><ul><li>Feature Name: rfc_0005_circuit_breaker_mechanism</li><li>Start Date: 2020-01-27</li><li>Issue: <a href="https://github.com/tremor-rs/tremor-rfcs/issues/8" target="_blank" rel="noopener noreferrer">tremor-rs/tremor-rfcs#0008</a></li><li>RFC PR: <a href="https://github.com/tremor-rs/tremor-rfcs/pull/9" target="_blank" rel="noopener noreferrer">tremor-rs/tremor-rfcs#0009</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>The tremor-runtime supports events from three different basic origins:</p><ul><li>Events are user-defined business data events that arrive ultimately via Onramps and depart ultimately via Oframps.</li><li>Signals are injected control events that are visible to operators and ramps.</li><li>Contraflow are injected control events that are visible to operators and ramps and travel in the contra-sense of primary flow.</li></ul><p>There is no mechanism to compensate for failures detected in externalising upstream or downstream components within the deployed graph of Tremor artefacts. The circuit-breaker operator defines an event protocol that standardises how failure detection signals, events and actions are communicated across the Tremor runtime.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="motivation"></a>Motivation<a class="hash-link" href="#motivation" title="Direct link to heading">#</a></h2><p>The absence of a standard and uniform circuit breaker interface prohibits authors of tremor-script/tremor-query from writing compensating logic and behaviours that are adaptive to failures in the runtime environment. The circuit breaker operator separates the signals, events and actions that are implied by circuit breakers with an operator that allows circuit breaker events to be leveraged by user-defined logic in the tremor-runtime regardless of the point of origin of those signals, events and actions.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="guide-level-explanation"></a>Guide-level Explanation<a class="hash-link" href="#guide-level-explanation" title="Direct link to heading">#</a></h2><p>Definition of a circuit breaker with exponential backoff strategy and a rate-based failure detector:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly trickle"><div tabindex="0" class="prism-code language-trickle codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">define qos::circuit_breaker operator cb</span></div><div class="token-line" style="color:#393A34"><span class="token plain">with</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    backoff = &quot;exponential&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    detector = &quot;success_rate_over_time_window&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Application of a circuit breaker to external inbound events from an external non-reliable data source</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly trickle"><div tabindex="0" class="prism-code language-trickle codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">create operator blue_smoke from cb;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">select event from in into cb;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">select event from cb/cb into out/cb;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Circuit Breaker signals:</p><ul><li>Circuit breaker opened.</li><li>Circuit breaker closed.</li></ul><p>Circuit breakers events:</p><ul><li>Opened- The circuit breaker has transitioned from &#x27;closed&#x27; to &#x27;opened&#x27; for a named external endpoint.</li><li>Closed- The circuit braeker has transitioned from &#x27;opened&#x27; to &#x27;closed&#x27; for a named external endpoint.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reference-level-explanation"></a>Reference-level Explanation<a class="hash-link" href="#reference-level-explanation" title="Direct link to heading">#</a></h2><p>None</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="drawbacks"></a>Drawbacks<a class="hash-link" href="#drawbacks" title="Direct link to heading">#</a></h2><p>None</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rationale-and-alternatives"></a>Rationale and Alternatives<a class="hash-link" href="#rationale-and-alternatives" title="Direct link to heading">#</a></h2><p>The introduction of circuit breakers enables finer-grained control of compensating logic when external sources or sinks are detected as failed. The circuit breaker operator encapsulates runtime signals and contraflow so that circuit breakers can be used in user defined logic.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="prior-art"></a>Prior Art<a class="hash-link" href="#prior-art" title="Direct link to heading">#</a></h2><p><a href="https://en.wikipedia.org/wiki/Circuit_breaker_design_pattern" target="_blank" rel="noopener noreferrer">Circuit Breaker Design Pattern</a>.</p><p><a href="https://crates.io/crates/crius" target="_blank" rel="noopener noreferrer">Crius</a>.</p><p><a href="https://crates.io/crates/failsafe" target="_blank" rel="noopener noreferrer">Failsafe</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="unresolved-questions"></a>Unresolved Questions<a class="hash-link" href="#unresolved-questions" title="Direct link to heading">#</a></h2><p>A related concern in the tremor-runtime is backoff handling for back-pressure in downstream systems ( eg: Influx, ElasticSearch ). These use contraflow to propagate context to a back-pressure operator.</p><p>There may be an opportunity to refactor the backpressure operator, separating our backoff handling logic. This should be considered by the implementor and this RFC updated accordingly.</p><p>This RFC does not specify internals or implementation which is left to the implementor. The motiviating example should be sufficient to drive a suitable implementation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="future-possibilities"></a>Future Possibilities<a class="hash-link" href="#future-possibilities" title="Direct link to heading">#</a></h2><p>None known at this time.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rfc/implemented/linked-transports"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Linked Transports</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rfc/implemented/pipeline-optimizations"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Pipeline Optimisations Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link">Summary</a></li><li><a href="#motivation" class="table-of-contents__link">Motivation</a></li><li><a href="#guide-level-explanation" class="table-of-contents__link">Guide-level Explanation</a></li><li><a href="#reference-level-explanation" class="table-of-contents__link">Reference-level Explanation</a></li><li><a href="#drawbacks" class="table-of-contents__link">Drawbacks</a></li><li><a href="#rationale-and-alternatives" class="table-of-contents__link">Rationale and Alternatives</a></li><li><a href="#prior-art" class="table-of-contents__link">Prior Art</a></li><li><a href="#unresolved-questions" class="table-of-contents__link">Unresolved Questions</a></li><li><a href="#future-possibilities" class="table-of-contents__link">Future Possibilities</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/quick-start/">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/faqs/">FAQs</a></li><li class="footer__item"><a class="footer__link-item" href="/api/0">Tremor API</a></li><li class="footer__item"><a class="footer__link-item" href="/community/governance/CodeofConduct">Code of Conduct</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://chat.tremor.rs/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/TremorDEBS" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://github.com/tremor-rs/tremor-runtime/releases" target="_blank" rel="noopener noreferrer" class="footer__link-item">Download</a></li><li class="footer__item"><a href="https://www.cncf.io/" target="_blank" rel="noreferrer noopener" aria-label="CNCF"><img src="cncf-color.svg" alt="CNCF"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/favicon.ico" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/favicon.ico" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div><div class="footer__copyright">Copyright Â© 2021 Tremor</div></div></div></footer></div>
<script src="/assets/js/runtime~main.29a598d0.js"></script>
<script src="/assets/js/main.a181b444.js"></script>
</body>
</html>