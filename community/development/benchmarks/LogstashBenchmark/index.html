<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tremor Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tremor Blog Atom Feed"><title data-react-helmet="true">Logstash Benchmark | Tremor</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://www.tremor.rs//community/development/benchmarks/LogstashBenchmark"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-community-current"><meta data-react-helmet="true" property="og:title" content="Logstash Benchmark | Tremor"><meta data-react-helmet="true" name="description" content="This section documents how to setup logstash for benchmarking to"><meta data-react-helmet="true" property="og:description" content="This section documents how to setup logstash for benchmarking to"><link data-react-helmet="true" rel="shortcut icon" href="/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.tremor.rs//community/development/benchmarks/LogstashBenchmark"><link data-react-helmet="true" rel="alternate" href="https://www.tremor.rs//community/development/benchmarks/LogstashBenchmark" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.tremor.rs//community/development/benchmarks/LogstashBenchmark" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.b987a0a0.css">
<link rel="preload" href="/assets/js/runtime~main.1d008a47.js" as="script">
<link rel="preload" href="/assets/js/main.95a75e05.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.tremor.rs/" target="_self" rel="noopener noreferrer" class="navbar__brand"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/tremor-logo.svg" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/community/getting-started/getting-started">Getting Started</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/community/community">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/community">Overview</a></li><li><a href="https://chat.tremor.rs" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Chat<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a class="dropdown__link" href="/community/governance">Governance</a></li><li><a class="dropdown__link" href="/community/faqs">FAQs</a></li><li><a class="dropdown__link" href="/rfc/index">RFCs</a></li><li><a class="dropdown__link" href="/community/EventsAndMedia">Events and Media</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/index">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/docs/index">0.11</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/index">Next</a></li><li><a class="dropdown__link" href="/docs/index">0.11</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://chat.tremor.rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discord-link" aria-label="Community Chat"></a><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/community/community">Community</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/community/governance">Governance</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Governance</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Development</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/community/development/benchmarking">Benchmarking</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">benchmarks</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/community/development/benchmarks/LogstashBenchmark">Logstash Benchmark</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/community/development/debugging">Debugging Tremor</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">internal</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/community/development/investigations">Investigations</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/community/development/profiling">Profiling Tremor</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/community/development/quick-start">Usage Guide</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/community/development/testing">Testing</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Events</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/community/eventsandmedia">Events and Media</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/community/faqs">FAQs</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/community/teams">Tremor Teams</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Logstash Benchmark</h1></header><p>This section documents how to setup logstash for benchmarking to
compare against tremor-script.</p><p><strong>The following benchmarks were taken with tremor <code>v0.5.0</code> on June 2019.</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="logstash"></a>Logstash<a class="hash-link" href="#logstash" title="Direct link to heading">#</a></h2><p>Assert that JDK 8 or higher is on your system path</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ java -version</span></span><span class="token-line" style="color:#393A34"><span class="token plain">java version </span><span class="token string" style="color:#e3116c">&quot;1.8.0_192-ea&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Java</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> SE Runtime Environment </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">build </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain">.0_192-ea-b04</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Java HotSpot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token plain">-Bit Server VM </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">build </span><span class="token number" style="color:#36acaa">25.192</span><span class="token plain">-b04, mixed mode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ javac -version</span></span><span class="token-line" style="color:#393A34"><span class="token plain">javac </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain">.0_192-ea</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Assert that JRuby 9.2 or higher is on your system path</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ jruby -v</span></span><span class="token-line" style="color:#393A34"><span class="token plain">jruby </span><span class="token number" style="color:#36acaa">9.2</span><span class="token plain">.6.0 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2.5</span><span class="token plain">.3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2019</span><span class="token plain">-02-11 15ba00b Java HotSpot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token plain">-Bit Server VM </span><span class="token number" style="color:#36acaa">25.192</span><span class="token plain">-b04 on </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain">.0_192-ea-b04 +jit </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">darwin-x86_64</span><span class="token punctuation" style="color:#393A34">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Assert that the <code>rake</code> and <code>bundler</code> ruby tools are installed</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ gem </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> rake bundler</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Fetching: rake-12.3.2.gem </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token plain">%</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully installed rake-12.3.2</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Fetching: bundler-2.0.2.gem </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token plain">%</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully installed bundler-2.0.2</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> gems installed</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Clone and build logstash and its benchmark tool</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/elastic/logstash</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> logstash</span></span><span class="token-line" style="color:#393A34"><span class="token plain">gradle clean assemble</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> tools/benchmark-cli</span></span><span class="token-line" style="color:#393A34"><span class="token plain">gradle clean assemble</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="benchmark-methodology"></a>Benchmark methodology<a class="hash-link" href="#benchmark-methodology" title="Direct link to heading">#</a></h2><p>In the first ( this ) version, this was a manual process</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="identify-performance-related-tunables-for-logstash"></a>Identify performance related tunables for logstash<a class="hash-link" href="#identify-performance-related-tunables-for-logstash" title="Direct link to heading">#</a></h2><p>Number of logstash workers ( default 2 )</p><p>Batch size for micro-batching queues in logstash workers ( default 128 )</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="identity-baseline-benchmark"></a>Identity baseline benchmark<a class="hash-link" href="#identity-baseline-benchmark" title="Direct link to heading">#</a></h2><p>Literally named baseline and is an equivalent in functionality to tremor&#x27;s <code>empty-passthrough-json</code> benchmark</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="for-each-logstash-tunable-run-a-benchmark"></a>For each logstash tunable, run a benchmark<a class="hash-link" href="#for-each-logstash-tunable-run-a-benchmark" title="Direct link to heading">#</a></h2><p>Given the baseline logstash benchmark and record <a target="_blank" href="/assets/files/logstash-baseline-log-57850cf693090be7b5ecacd67f315e91.txt">results</a> and initial <a target="_blank" href="/assets/files/logstash-baseline-log-analysis-53b796f0cf2193dc7fb05df77797ab4c.csv">analysis</a></p><p>Document command line arguments required to evaluated each run/iteration</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ java -cp build/libs/benchmark-cli.jar org.logstash.benchmark.cli.Main </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      --testcase</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">baseline --distribution-version</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5.5</span><span class="token plain">.0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      --ls-workers </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">num-workers</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      --ls-batch-size </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">batch-size</span><span class="token operator" style="color:#393A34">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="for-each-tremor-tunable-run-a-benchmark"></a>For each tremor tunable, run a benchmark<a class="hash-link" href="#for-each-tremor-tunable-run-a-benchmark" title="Direct link to heading">#</a></h2><p>Given the <code>empty-passthrough-json</code> equivalent benchmark.</p><p>Tremor has no performance-related tunables.</p><p>Tremor&#x27;s benchmark framework has no performance-related tunables for the <code>empty-passthrough-json</code> equivalent benchmark</p><p>Record <a target="_blank" href="/assets/files/tremor-baseline-log-1ef1039c92c59df91b1abc54cd498665.txt">results</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="benchmark-conditioning-and-environment"></a>Benchmark conditioning and environment<a class="hash-link" href="#benchmark-conditioning-and-environment" title="Direct link to heading">#</a></h2><p>The <code>benchmark-cli</code> tool that ships with logstash suffers from a number of issues.</p><p>The number of events in each run is fixed and limited to 1 million events per run.</p><p>No accommodation is made for warmup to ensure that the JVM has reached a stable state before results recording begins.</p><p>The framework also incorrectly terminates after each run once 1 million results have been submitted. It should not complete until all workers have drained their respective queues and the benchmark reaches a quiescent state. Quiescence is not asserted.</p><p>This means that the number of recorded processed events can be less than the configured target by a significant margin. As these are <em>micro-benchmarks</em> and we are concerned with Order of Magnitude differences in performance we have not expended effort resolving these issues.</p><p>A further issue with the logstash <code>benchmark-cli</code> tool is that the results suffer from the coordinated omission problem.</p><p>The coordinated omission problem, is a term first-coined by Gil Tene based on the observations in benchmarking the Azul Vega hardware and Zing JVM with C4 garbage collector and related ZTS subsystems). In a nutshell, coordinated-omission is where a benchmarking tool ( usually unintentionally ) incorrectly records events under measurement time spans by failing to record the intended verses actual time to record. Specifically, it is insufficient to record the start time and end time of a particular event of interest. Capturing the start and end time allows the delta or servicing time to be computed. It does not capture any synchronization overhead, waiting time, delays or other system-induced hiccups introduced between up to the point the event should have started. We fail to capture unintentional drift introduced artificially by the benchmark framework when CO is in force. Well-designed benchmarks should be CO-free.</p><p>Tremor&#x27;s benchmarking facility allows events to be injected at a fixed frequency. This tactic ( which more specifically, pins the intended commencement time for an event to begin processing to a starting epoch ) is sufficient to practically account for any hiccups or drift in expected verses actual inter-arrival based on designed constraints in a benchmark framework. By selecting a fixed static frequency any measured hiccups should be outside of the control of the benchmark framework - they are either artifacts of the scenario under test, or the system upon which it is being tested. These conditions are optimal in all benchmark testing, but an absolute necessity for any latency-sensitive testing, especially where fine-grained statistic quartiles are being computed if they are to impart results that are fit for low-level analysis and interpretation.</p><p>Coordinated-omission-free benchmarks are important for micro-benchmarking and latency-driven benchmarking. However, as we are interested in Order of Magnitude ( finger in the air ) characteristics rather than isolating long-tail latencies or understanding fine-grained latency characteristics on a per-event basis ( say, at the long-tail of performance beyond the 99.99th percentile )</p><p>In short, tremor makes some effort to account for coordinated-omission where relevant, but logstash&#x27;s benchmark framework does not. However, as we are taking a 50,000-foot view of characteristic throughput and are not focusing on specific per-event latency characteristics the identified issues are negligible for our analysis.</p><p>It would be incorrect however, to focus on per-event performance characteristics or focus in on specific latency quartiles or throughput quartiles to derive any significance. Such an analysis would require more effort and would not necessarily deliver any greater value.</p><p>We have not used lab-quality environments to run any of the benchmarks. All benchmarks were run on the same development grade laptop ( not ideal ) with the same background processes active on an intel / Mac OS X x86_64 environment. As such we consider the results indicative of characteristics and <code>good enough</code> for high-level analysis.</p><p>It should, however, be a small task to follow this report to replicate the characteristic results detailed in this report and accompanying evidence and to replicate the same on similar resources.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="baseline-analysis"></a>Baseline Analysis<a class="hash-link" href="#baseline-analysis" title="Direct link to heading">#</a></h2><p>Logstash&#x27;s <code>benchmark-cli</code> was put through 40 variations of its two tunable parameters.</p><p>We tested with 1, 2, 4 and 8 logstash workers.</p><p>We tested each worker configuration with queue batch size bounds of 1, 2, 4, 8, 16, 32, 64, 128, 256 and 512.</p><p>The best of 3 runs was recorded.</p><p>As tremor has no tunables we recorded the best of 3 runs.</p><p>Logstash is configured out of the box for 2 workers and a batch size of 128. There are marginally better configurations possible with 4 or 8 workers showing marginal throughput benefits given the use-case selected. Configuring a single worker has a significant negative impact on performance.</p><p>As such logstash is well-configured out of the box, at least for typical development or non-production activities.</p><p>The optimal configuration on the test machine was configured with 8 workers ( default 2 ) and a batch size of 256 ( default 128 ). This is less than 1% of a difference. Generally speaking, batch sizes of less than 32 tend to significantly reduce throughput for any number of configured workers. Also, generally speaking, the improvement from 2 worker threads to more does not demonstrate any improvement in scaling. As such multi-core scaling with logstash does not seem to be of much benefit beyond 2 workers ( threads ).</p><p>It should be noted that the benchmark creates artificial conditions and that the baseline working-set is atypical of production working sets. On the other hand, this conditioning is the same with respect to tremor whose baseline benchmark is equivalent.</p><p>In both cases we ingest, forward and publish an event or <code>pass it through</code> the system under test.</p><p>As logstash is configured for a fixed ceiling of events ( 1 million ) for a benchmark run, and tremor is configured for a specific test duration ( as many events as possible in 40 seconds ) we need to baseline the results. We bias in favor of tremor as normative and compute the effective throughput at 40 seconds for each logstash run. So a 63 second run with 8 workes and a batch size of 1 38 seconds run at batch size 256 respectively for logstash is counted as the equivalent 40 seconds run as follows:</p><table><thead><tr><th>Logstash Default (W2 W128)</th><th>Logstash Worst (W1 B1)</th><th>Logstash Best (W8 B256)</th><th>Tremor (baseline)</th></tr></thead><tbody><tr><td>1033811</td><td>466708</td><td>1041943</td><td>21402853</td></tr></tbody></table><p>Note that we truncate / floor round the equivalent logstash 40-second results for each selected configuration.</p><p>Relative to the worst case logstash benchmark run performance:</p><table><thead><tr><th>Logstash W2 W128 ( default )</th><th>Logstash W8 B1</th><th>Logstash W8 B256</th><th>Tremor ( baseline )</th></tr></thead><tbody><tr><td>2.22</td><td>1</td><td>2.23</td><td>45.86</td></tr></tbody></table><p>Logstash can itself benefit from at least a 2x improvement, and this is consistent with the default out of the box configuration.</p><p>Tremor, however, is a factor of 45 better than the logstash worst case. Tremor, compared to the logstash best case, is still a factor of 20.54 higher throughput.</p><p>So the total effective range of improvement for the given benchmark ( all other things considered equal ) is somewhere between a 20x to 45x increase in throughput favoring tremor over logstash for the baseline use case based on experimental conditions detailed in this report.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="production-analysis"></a>Production Analysis<a class="hash-link" href="#production-analysis" title="Direct link to heading">#</a></h2><p>We don&#x27;t typically deploy logstash or tremor into production as a distribution proxy or interconnect that passes through events. Logstash would be a pretty bad choice compared to tremor. But tremor, although it has excellent conditioning and is designed for elegantly handling back-pressure and saturation conditions for log shipping and distribution - it does not provide the delivery semantics, retention and feature-set of technologies such as Kafka.</p><p>For the level 1 traffic limiting, traffic shaping and rate-limiting use cases in Level 3 Logging at Wayfair for which tremor was originally designed we have seen a 7x-8x improvement in density compared to logstash for v0.4 of tremor. v0.5 should increase this to the 10x ballpark as we benefit from SIMD vectorization of JSON deserialization. However, there is further room for improvement as the tremor-script language has evolved to handle level 2 logging to replace ruby and logstash with far richer configuration than level 1. In v0.5 performance is a non-goal; as such there are many optimisations to the new tremor-script domain-specific-langauge that we have yet to undertake - so in practice for level 2 logging we won&#x27;t see the full benefit of SIMD vectorization as some of those gains are ammortised by additional essential complexity of providing a richer DSL to support replacing logstash in level 2.</p><p>Indicatively, we stand to see a range of 20x-40x improvement. In production we have <em>observed</em> closer to a 7x-8x improvement in density with the L3 replacement, and with the v0.4 upgrade to L1 in GCP pre-live. We expect a further modest incremental improvement in L1 with v0.5, and a good ~10x over logstash for L2 this ( v0.5 ) release.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="apache-logs-scenario"></a>Apache Logs Scenario<a class="hash-link" href="#apache-logs-scenario" title="Direct link to heading">#</a></h2><p>Logstash ships with a benchmark where logstash is configured for Apache log processing and elementization. We have ported this benchmark to tremor for coparative purposes.</p><p>Tremor processes <a target="_blank" href="/assets/files/tremor-apache-log-31261a5bcc1fd13a9f4e59895199bdce.txt">44109658</a> messages in 100 seconds fixed interval ( continuously replaying ), whereas logstash takes 751 seconds to process the same <a target="_blank" href="/assets/files/logstash-apache-log-ff8802168ba59e5d80c0213c383ac978.txt">6900000</a> log records.</p><p>This is 48x speedup in favour of tremor.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="logging-level-2-replacement-scenario"></a>Logging Level 2 Replacement Scenario<a class="hash-link" href="#logging-level-2-replacement-scenario" title="Direct link to heading">#</a></h2><p>Tremor ships with a benchmark where the enrichment component of logstash replacement running in production has been used to drive the implementation of tremor-script features in the v0.5 release.</p><p>We have minimally modified the logstash benchmark client to support running logstash equivalent configuration of tremor ( or vice-versa ) to get as close to possible to a fair apples-to-apples comparison. We have stopped short of fixing fundemental issues with the logstash benchmark framework itself.</p><p>Tremor process <a target="_blank" href="/assets/files/tremor-l2-log-f857de7c8608f46053844cbda67ea9cf.txt">2262222</a> records in 100 seconds fixed interval ( continuously replaying ), whereas logstash takes 66 seconds to process <a target="_blank" href="/assets/files/logstash-l2-log-65a9d0adb29c12c5660c841c44ff4ea5.txt">200000</a> records. This equates to a ballpark 7.5x speedup in favour of tremor.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="logging-level-2-replacement-bad-case"></a>Logging Level 2 Replacement bad case<a class="hash-link" href="#logging-level-2-replacement-bad-case" title="Direct link to heading">#</a></h2><p>Benchmarking the validation/transformation scenario involves a more complex script with loops and deeper nested expressions. Here some of the shortcuts we took to implement the new tremor script in a reasonable timeframe surface as performance bottlenecks.</p><p>Again ran the transformation script with both Logstash as well tremor with configurations as close to equivalent as possible.</p><p>Tremor processes <a target="_blank" href="/assets/files/tremor-transform-log-6ba971f5b0d506b6abdf157fbabb66fd.txt">73132</a> records in 100 seconds fixed interval ( continuously replaying ), whereas logstash takes 87 seconds to process <a target="_blank" href="/assets/files/logstash-transform-log-7b996db208133aa029d1eea0440b224a.txt">150000</a> records. In this case tremor is about 2.3x slower then a comparable logstasv configuration.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/community/development/benchmarking"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Benchmarking</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/community/development/debugging"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Debugging Tremor Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#logstash" class="table-of-contents__link">Logstash</a></li><li><a href="#benchmark-methodology" class="table-of-contents__link">Benchmark methodology</a></li><li><a href="#identify-performance-related-tunables-for-logstash" class="table-of-contents__link">Identify performance related tunables for logstash</a></li><li><a href="#identity-baseline-benchmark" class="table-of-contents__link">Identity baseline benchmark</a></li><li><a href="#for-each-logstash-tunable-run-a-benchmark" class="table-of-contents__link">For each logstash tunable, run a benchmark</a></li><li><a href="#for-each-tremor-tunable-run-a-benchmark" class="table-of-contents__link">For each tremor tunable, run a benchmark</a></li><li><a href="#benchmark-conditioning-and-environment" class="table-of-contents__link">Benchmark conditioning and environment</a></li><li><a href="#baseline-analysis" class="table-of-contents__link">Baseline Analysis</a></li><li><a href="#production-analysis" class="table-of-contents__link">Production Analysis</a></li><li><a href="#apache-logs-scenario" class="table-of-contents__link">Apache Logs Scenario</a></li><li><a href="#logging-level-2-replacement-scenario" class="table-of-contents__link">Logging Level 2 Replacement Scenario</a></li><li><a href="#logging-level-2-replacement-bad-case" class="table-of-contents__link">Logging Level 2 Replacement bad case</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/quick-start/">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/community/faqs">FAQs</a></li><li class="footer__item"><a class="footer__link-item" href="/api/0">Tremor API</a></li><li class="footer__item"><a class="footer__link-item" href="/community/governance/CodeofConduct">Code of Conduct</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://chat.tremor.rs/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/TremorDEBS" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/tremor-rs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/tremor-rs/tremor-runtime/releases" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Download<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.cncf.io/" target="_blank" rel="noreferrer noopener" aria-label="CNCF"><img src="/img/cncf-color.svg" alt="CNCF" style="width: 200px;"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/favicon.ico" alt="Tremor Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/favicon.ico" alt="Tremor Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div><div class="footer__copyright">Copyright Â© 2021 Tremor</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1d008a47.js"></script>
<script src="/assets/js/main.95a75e05.js"></script>
</body>
</html>